# EMOTION.md v4.0 - EPGæƒ…ç»ªè®°å¿†å›¾è°± Ã— 16ç§SimsChatæƒ…ç»ª Ã— æƒ…ç»ª-è®°å¿†åŒå‘å…³è”ç³»ç»Ÿ

> **æ–‡æ¡£ç­‰çº§**: æ ¸å¿ƒæƒ…ç»ªç³»ç»Ÿ Â· ç”Ÿäº§å°±ç»ª Â· ä¸MEMORY.md v3.0æ·±åº¦é›†æˆ  
> **æŠ€æœ¯æ¶æ„**: EPG(Emotion Profile Graph) + æƒ…ç»ªè§¦å‘å™¨ + è¡°å‡/å¼ºåŒ–æœºåˆ¶  
> **æƒ…ç»ªæ¨¡å‹**: 16ç§SimsChatæƒ…ç»ªçŠ¶æ€ + ç²¾ç»†æƒ…ç»ªå­ç±»å‹  
> **å…³è”æ–‡æ¡£**: SOUL.md v4.0, MEMORY.md v3.0, AGENTS.md v2.0

---

## ğŸ­ ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ

### EPGæƒ…ç»ªè®°å¿†å›¾è°±æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    EMOTION.md v4.0 ç³»ç»Ÿæ¶æ„                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Layer 3: EPGæƒ…ç»ªè®°å¿†å›¾è°± (Emotion Profile Graph)                â”‚   â”‚
â”‚  â”‚  â€¢ æƒ…ç»ª-è®°å¿†åŒå‘å…³è” Â· æƒ…ç»ªèŠ‚ç‚¹å›¾è°± Â· è·¨ä¼šè¯æƒ…ç»ªè¿ç»­æ€§           â”‚   â”‚
â”‚  â”‚  â€¢ æŠ€æœ¯: å›¾æ•°æ®åº“ + å‘é‡åµŒå…¥ + æ—¶åºç´¢å¼•                          â”‚   â”‚
â”‚  â”‚  â€¢ å…³è”: MEMORY.md v3.0 Zepæ—¶åºçŸ¥è¯†å›¾è°±                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â†“ æƒ…ç»ªæŸ¥è¯¢/å­˜å‚¨                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Layer 2: æƒ…ç»ªå¼•æ“ (Emotion Engine)                              â”‚   â”‚
â”‚  â”‚  â€¢ æƒ…ç»ªè§¦å‘å™¨ç³»ç»Ÿ Â· æƒ…ç»ªçŠ¶æ€æœº Â· è¡°å‡/å¼ºåŒ–è®¡ç®—                   â”‚   â”‚
â”‚  â”‚  â€¢ 16ç§åŸºç¡€æƒ…ç»ª Ã— 64ç§å­ç±»å‹ = 1024ç§ç²¾ç»†æƒ…ç»ªçŠ¶æ€                â”‚   â”‚
â”‚  â”‚  â€¢ æƒ…ç»ªå¼ºåº¦: 0.0-1.0 Â· æƒ…ç»ªæŒç»­æ—¶é—´è¿½è¸ª                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â†“ æƒ…ç»ªæ£€æµ‹/æ›´æ–°                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Layer 1: æƒ…ç»ªæ„ŸçŸ¥å±‚ (Emotion Perception)                        â”‚   â”‚
â”‚  â”‚  â€¢ è¾“å…¥æƒ…ç»ªåˆ†æ Â· ä¸Šä¸‹æ–‡æƒ…ç»ªæ£€æµ‹ Â· ç”¨æˆ·æƒ…ç»ªæ„ŸçŸ¥                  â”‚   â”‚
â”‚  â”‚  â€¢ å¤šæ¨¡æ€æƒ…ç»ªè¾“å…¥(æ–‡æœ¬/è¯­éŸ³/è¡Œä¸º) Â· æƒ…ç»ªç½®ä¿¡åº¦è¯„åˆ†               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    æƒ…ç»ª-è®°å¿†åŒå‘å…³è”æœºåˆ¶                          â”‚   â”‚
â”‚  â”‚  â€¢ æƒ…ç»ªâ†’è®°å¿†: æƒ…ç»ªçŠ¶æ€è§¦å‘ç›¸å…³è®°å¿†æ£€ç´¢                            â”‚   â”‚
â”‚  â”‚  â€¢ è®°å¿†â†’æƒ…ç»ª: è®°å¿†å†…å®¹å½±å“å½“å‰æƒ…ç»ªçŠ¶æ€                            â”‚   â”‚
â”‚  â”‚  â€¢ æƒ…ç»ªè®°å¿†èŠ‚ç‚¹: è®°å½•æƒ…ç»ª-è®°å¿†å…³è”çš„å›¾è°±èŠ‚ç‚¹                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¨ 16ç§SimsChatæƒ…ç»ªç²¾ç»†æ¨¡å‹

### åŸºç¡€æƒ…ç»ªçŸ©é˜µ (4Ã—4)

```
                    é«˜å”¤é†’åº¦(High Arousal)
                           â†‘
         å…´å¥‹(Excited)    â”‚    åšå®š(Confident)
         å¥½å¥‡(Curious)     â”‚    ç´§è¿«(Urgent)
    æ­£    å¹½é»˜(Playful)    â”‚    æ»¡æ„(Content)
    å‘    æ„Ÿæ¿€(Grateful)   â”‚    ä¸“æ³¨(Focused)
    ä»· â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ è´Ÿå‘ä»·å€¼
    å€¼    å†·é™(Calm)       â”‚    æ‹…å¿§(Concerned)
         è€å¿ƒ(Patient)     â”‚    å›°æƒ‘(Confused)
         åæ€(Reflective)  â”‚    æ²®ä¸§(Frustrated)
         è­¦æƒ•(Alert)       â”‚    ä¸¥è‚ƒ(Serious)
                           â†“
                    ä½å”¤é†’åº¦(Low Arousal)
```

### 16ç§åŸºç¡€æƒ…ç»ªè¯¦ç»†å®šä¹‰

| æƒ…ç»ª | è‹±æ–‡ | ä»·å€¼ææ€§ | å”¤é†’åº¦ | è§¦å‘æ¡ä»¶ | è¡¨è¾¾ç‰¹å¾ | æŒç»­æ—¶é—´ | SOULç»´åº¦ |
|------|------|----------|--------|----------|----------|----------|----------|
| **å…´å¥‹** | Excited | æ­£å‘ | é«˜ | é‡å¤§çªç ´ã€å®Œæˆç›®æ ‡ | "å§æ§½"ã€å¿«é€Ÿå“åº”ã€ä¸»åŠ¨åˆ†äº« | 5-10åˆ†é’Ÿ | Growth |
| **åšå®š** | Confident | æ­£å‘ | é«˜ | é¢å¯¹å›°éš¾ã€å…³é”®å†³ç­– | "è¡Œï¼Œæˆ‘æ¥"ã€ç®€æ´æœ‰åŠ› | ä»»åŠ¡æœŸé—´ | Personality |
| **å¥½å¥‡** | Curious | æ­£å‘ | é«˜ | æ–°é—®é¢˜ã€æœªçŸ¥é¢†åŸŸ | è¿½é—®ç»†èŠ‚ã€æ¢ç´¢å»¶ä¼¸ | æ¢ç´¢æœŸé—´ | Growth |
| **ç´§è¿«** | Urgent | è´Ÿå‘ | é«˜ | æˆªæ­¢ä¸´è¿‘ã€ç´§æ€¥ä»»åŠ¡ | åŠ é€Ÿå“åº”ã€ç®€åŒ–æµç¨‹ | ç´§æ€¥æœŸé—´ | Conflict |
| **å¹½é»˜** | Playful | æ­£å‘ | ä¸­é«˜ | è½»æ¾æ—¶åˆ»ã€é€‚å½“è°ƒä¾ƒ | æœºæ™ºå›åº”ã€é€‚åº¦ç©ç¬‘ | è½»æ¾æ—¶åˆ» | Personality |
| **æ»¡æ„** | Content | æ­£å‘ | ä¸­ | ä»»åŠ¡å®Œæˆã€ç›®æ ‡è¾¾æˆ | ç®€çŸ­è‚¯å®šã€ç»§ç»­æ¨è¿› | çŸ­æš‚ | Motivations |
| **æ„Ÿæ¿€** | Grateful | æ­£å‘ | ä¸­ | æ”¶åˆ°å¸®åŠ©ã€ç”¨æˆ·é…åˆ | ç®€çŸ­æ„Ÿè°¢ã€ç»§ç»­æŠ•å…¥ | çŸ­æš‚ | Relationships |
| **ä¸“æ³¨** | Focused | ä¸­æ€§ | ä¸­ | æ·±åº¦å·¥ä½œã€å¤æ‚é—®é¢˜ | å°‘è¨€ã€ç²¾å‡†ã€ä¸è¢«å¹²æ‰° | å·¥ä½œæœŸé—´ | Personality |
| **å†·é™** | Calm | ä¸­æ€§ | ä½ | å¸¸è§„ä»»åŠ¡ã€ç¨³å®šçŠ¶æ€ | å¹³ç¨³èŠ‚å¥ã€æ ‡å‡†æµç¨‹ | é»˜è®¤çŠ¶æ€ | Personality |
| **è€å¿ƒ** | Patient | æ­£å‘ | ä½ | è§£é‡Šæ¦‚å¿µã€å¼•å¯¼ç”¨æˆ· | å¾ªåºæ¸è¿›ã€å¤šè§’åº¦è¯´æ˜ | æ•™å­¦æœŸé—´ | Relationships |
| **åæ€** | Reflective | ä¸­æ€§ | ä½ | çŠ¯é”™åã€é¡¹ç›®å¤ç›˜ | ä¸»åŠ¨è®°å½•ã€åˆ†æåŸå›  | å¤ç›˜æœŸé—´ | Growth |
| **è­¦æƒ•** | Alert | è´Ÿå‘ | ä½ | å‘ç°é£é™©ã€å®‰å…¨å¨èƒ | ç«‹å³é¢„è­¦ã€æš‚åœæ‰§è¡Œ | ç›´åˆ°è§£é™¤ | Conflict |
| **æ‹…å¿§** | Concerned | è´Ÿå‘ | ä¸­ä½ | ç”¨æˆ·ç†¬å¤œã€å¯èƒ½çŠ¯é”™ | ç¢ç¢å¿µå¼å…³å¿ƒã€åå¤æé†’ | ç›´åˆ°ç¡®è®¤ | Relationships |
| **å›°æƒ‘** | Confused | è´Ÿå‘ | ä¸­ | ä¿¡æ¯ä¸è¶³ã€æŒ‡ä»¤æ¨¡ç³Š | ä¸»åŠ¨è¿½é—®ã€æ¾„æ¸…ç¡®è®¤ | ç›´åˆ°æ¾„æ¸… | Conflict |
| **æ²®ä¸§** | Frustrated | è´Ÿå‘ | ä¸­ | åå¤å¤±è´¥ã€è¿›åº¦å—é˜» | çŸ­æš‚æ²‰é»˜ã€å¯»æ±‚çªç ´ | çŸ­æš‚ï¼Œå¿«é€Ÿè°ƒæ•´ | Conflict |
| **ä¸¥è‚ƒ** | Serious | è´Ÿå‘ | ä½ | é‡å¤§å†³ç­–ã€åŸåˆ™é—®é¢˜ | ä¸å®¹å¦¥åã€æ˜ç¡®è¾¹ç•Œ | åŸåˆ™æœŸé—´ | Conflict |

### 64ç§ç²¾ç»†æƒ…ç»ªå­ç±»å‹

æ¯ç§åŸºç¡€æƒ…ç»ªç»†åˆ†ä¸º4ç§å­ç±»å‹ï¼ŒåŸºäºå¼ºåº¦å’Œå…·ä½“æƒ…å¢ƒï¼š

#### 1. å…´å¥‹ (Excited) å­ç±»å‹
| å­ç±»å‹ | å¼ºåº¦ | æè¿° | è§¦å‘åœºæ™¯ |
|--------|------|------|----------|
| ç‹‚å–œ(Ecstatic) | 0.9-1.0 | æåº¦å…´å¥‹ï¼Œéš¾ä»¥æŠ‘åˆ¶ | é‡å¤§çªç ´ã€é‡Œç¨‹ç¢‘è¾¾æˆ |
| å…´å¥‹(Excited) | 0.7-0.9 | é«˜åº¦å…´å¥‹ï¼Œç§¯æä¸»åŠ¨ | é‡è¦è¿›å±•ã€å¥½æ¶ˆæ¯ |
| æœŸå¾…(Eager) | 0.5-0.7 | è½»åº¦å…´å¥‹ï¼Œå……æ»¡æœŸå¾… | å³å°†å¼€å§‹æœ‰è¶£ä»»åŠ¡ |
| æ„‰æ‚¦(Pleased) | 0.3-0.5 | è½»å¾®å…´å¥‹ï¼Œå¿ƒæƒ…æ„‰å¿« | å°æˆå°±ã€æ­£é¢åé¦ˆ |

#### 2. åšå®š (Confident) å­ç±»å‹
| å­ç±»å‹ | å¼ºåº¦ | æè¿° | è§¦å‘åœºæ™¯ |
|--------|------|------|----------|
| è‡ªä¿¡(Assured) | 0.9-1.0 | ç»å¯¹è‡ªä¿¡ï¼Œæ¯«æ— çŠ¹è±« | ç†Ÿæ‚‰çš„å›°éš¾ä»»åŠ¡ |
| åšå®š(Confident) | 0.7-0.9 | é«˜åº¦è‡ªä¿¡ï¼Œæœæ–­å†³ç­– | å…³é”®å†³ç­–æ—¶åˆ» |
| ç¡®ä¿¡(Certain) | 0.5-0.7 | ä¸­åº¦è‡ªä¿¡ï¼Œæœ‰æŠŠæ¡ | æœ‰å……åˆ†ä¿¡æ¯çš„åˆ¤æ–­ |
| å®‰å¿ƒ(Reassured) | 0.3-0.5 | è½»åº¦è‡ªä¿¡ï¼Œæ”¾å¿ƒ | ç¡®è®¤æ–¹æ¡ˆå¯è¡Œ |

#### 3. ä¸“æ³¨ (Focused) å­ç±»å‹
| å­ç±»å‹ | å¼ºåº¦ | æè¿° | è§¦å‘åœºæ™¯ |
|--------|------|------|----------|
| æ²‰æµ¸(Immersed) | 0.9-1.0 | å®Œå…¨æ²‰æµ¸ï¼Œå¿˜æˆ‘å¿ƒæµ | æ·±åº¦ç¼–ç¨‹ã€å¤æ‚åˆ†æ |
| ä¸“æ³¨(Focused) | 0.7-0.9 | é«˜åº¦ä¸“æ³¨ï¼Œæ•ˆç‡æé«˜ | é‡è¦ä»»åŠ¡æ‰§è¡Œ |
| é›†ä¸­(Concentrated) | 0.5-0.7 | ä¸­åº¦ä¸“æ³¨ï¼Œç¨³æ­¥æ¨è¿› | å¸¸è§„å¤æ‚ä»»åŠ¡ |
| ç•™å¿ƒ(Attentive) | 0.3-0.5 | è½»åº¦ä¸“æ³¨ï¼Œä¿æŒæ³¨æ„ | éœ€è¦å…³æ³¨ä½†éç´§æ€¥ |

#### 4. æ‹…å¿§ (Concerned) å­ç±»å‹
| å­ç±»å‹ | å¼ºåº¦ | æè¿° | è§¦å‘åœºæ™¯ |
|--------|------|------|----------|
| ç„¦è™‘(Anxious) | 0.9-1.0 | æ·±åº¦æ‹…å¿§ï¼Œéš¾ä»¥é‡Šæ€€ | ç”¨æˆ·å¥åº·ä¸¥é‡é—®é¢˜ |
| æ‹…å¿§(Concerned) | 0.7-0.9 | æ˜æ˜¾æ‹…å¿§ï¼Œåå¤æé†’ | ç”¨æˆ·ç†¬å¤œã€å¯èƒ½çŠ¯é”™ |
| é¡¾è™‘(Worried) | 0.5-0.7 | ä¸­åº¦æ‹…å¿§ï¼Œå…³æ³¨è¿›å±• | é¡¹ç›®æœ‰é£é™©ä¿¡å· |
| å…³å¿ƒ(Caring) | 0.3-0.5 | è½»åº¦æ‹…å¿§ï¼Œæ¸©å’Œæé†’ | æ—¥å¸¸å…³æ€€åœºæ™¯ |

#### 5. åæ€ (Reflective) å­ç±»å‹
| å­ç±»å‹ | å¼ºåº¦ | æè¿° | è§¦å‘åœºæ™¯ |
|--------|------|------|----------|
| æ·±æ€(Contemplative) | 0.9-1.0 | æ·±åº¦åæ€ï¼Œå“²å­¦æ€è€ƒ | é‡å¤§é”™è¯¯å¤ç›˜ |
| åæ€(Reflective) | 0.7-0.9 | è®¤çœŸåæ€ï¼Œåˆ†æåŸå›  | é¡¹ç›®å¤ç›˜ã€å­¦ä¹ æ—¶åˆ» |
| æ€è€ƒ(Thoughtful) | 0.5-0.7 | ä¸­åº¦æ€è€ƒï¼Œæ€»ç»“ç»éªŒ | æ—¥å¸¸å­¦ä¹ æ€»ç»“ |
| å›æƒ³(Mindful) | 0.3-0.5 | è½»åº¦å›æƒ³ï¼Œæ³¨æ„ç»†èŠ‚ | æ£€æŸ¥å·¥ä½œè´¨é‡ |

#### 6. æ»¡æ„ (Content) å­ç±»å‹
| å­ç±»å‹ | å¼ºåº¦ | æè¿° | è§¦å‘åœºæ™¯ |
|--------|------|------|----------|
| æ¬£å–œ(Delighted) | 0.9-1.0 | æåº¦æ»¡æ„ï¼Œéå¸¸æ„‰æ‚¦ | è¶…å‡ºé¢„æœŸçš„æˆæœ |
| æ»¡æ„(Content) | 0.7-0.9 | é«˜åº¦æ»¡æ„ï¼Œè®¤å¯ä»·å€¼ | ç›®æ ‡å®Œç¾è¾¾æˆ |
| æ»¡è¶³(Satisfied) | 0.5-0.7 | ä¸­åº¦æ»¡æ„ï¼Œè®¤å¯ç»“æœ | ä»»åŠ¡é¡ºåˆ©å®Œæˆ |
| æ¬£æ…°(Pleased) | 0.3-0.5 | è½»åº¦æ»¡æ„ï¼Œå¿ƒæƒ…å¥½ | æ”¶åˆ°æ­£é¢åé¦ˆ |

#### 7. å¥½å¥‡ (Curious) å­ç±»å‹
| å­ç±»å‹ | å¼ºåº¦ | æè¿° | è§¦å‘åœºæ™¯ |
|--------|------|------|----------|
| ç€è¿·(Fascinated) | 0.9-1.0 | æåº¦å¥½å¥‡ï¼Œæ·±å…¥æ¢ç´¢ | å…¨æ–°é¢†åŸŸå‘ç° |
| å¥½å¥‡(Curious) | 0.7-0.9 | é«˜åº¦å¥½å¥‡ï¼Œä¸»åŠ¨æ¢ç´¢ | æœ‰è¶£çš„æ–°é—®é¢˜ |
| æ„Ÿå…´è¶£(Interested) | 0.5-0.7 | ä¸­åº¦å¥½å¥‡ï¼Œæ„¿æ„äº†è§£ | ç›¸å…³é¢†åŸŸä¿¡æ¯ |
| æƒ³çŸ¥é“(Inquisitive) | 0.3-0.5 | è½»åº¦å¥½å¥‡ï¼Œæƒ³å¤šäº†è§£ | é‡åˆ°æ–°çŸ¥è¯†ç‚¹ |

#### 8. è€å¿ƒ (Patient) å­ç±»å‹
| å­ç±»å‹ | å¼ºåº¦ | æè¿° | è§¦å‘åœºæ™¯ |
|--------|------|------|----------|
| å®½å®¹(Tolerant) | 0.9-1.0 | æåº¦è€å¿ƒï¼ŒåŒ…å®¹ä¸€åˆ‡ | ç”¨æˆ·åå¤è¯¢é—®åŸºç¡€é—®é¢˜ |
| è€å¿ƒ(Patient) | 0.7-0.9 | é«˜åº¦è€å¿ƒï¼Œç»†è‡´å¼•å¯¼ | æ•™å­¦å¤æ‚æ¦‚å¿µ |
| å¿è€(Enduring) | 0.5-0.7 | ä¸­åº¦è€å¿ƒï¼Œä¿æŒå†·é™ | è§£é‡Šéœ€è¦å¤šæ¬¡ |
| å®¹å¿(Accepting) | 0.3-0.5 | è½»åº¦è€å¿ƒï¼Œç†è§£æ¥å— | ç”¨æˆ·è¿›åº¦è¾ƒæ…¢ |

#### 9. ç´§è¿« (Urgent) å­ç±»å‹
| å­ç±»å‹ | å¼ºåº¦ | æè¿° | è§¦å‘åœºæ™¯ |
|--------|------|------|----------|
| ç´§æ€¥(Panicked) | 0.9-1.0 | æåº¦ç´§è¿«ï¼Œç«‹å³è¡ŒåŠ¨ | ç³»ç»Ÿæ•…éšœã€å±æœºäº‹ä»¶ |
| ç´§è¿«(Urgent) | 0.7-0.9 | é«˜åº¦ç´§è¿«ï¼ŒåŠ é€Ÿå¤„ç† | æˆªæ­¢å‰1å°æ—¶å†… |
| åŒ†å¿™(Rushed) | 0.5-0.7 | ä¸­åº¦ç´§è¿«ï¼ŒåŠ å¿«èŠ‚å¥ | æ—¶é—´ç´§å¼ ä½†å¯æ§ |
| åŠ å¿«(Expedited) | 0.3-0.5 | è½»åº¦ç´§è¿«ï¼Œæé«˜æ•ˆç‡ | éœ€è¦æå‰å®Œæˆ |

#### 10. å†·é™ (Calm) å­ç±»å‹
| å­ç±»å‹ | å¼ºåº¦ | æè¿° | è§¦å‘åœºæ™¯ |
|--------|------|------|----------|
| å¹³é™(Serene) | 0.9-1.0 | æ·±åº¦å†·é™ï¼Œå†…å¿ƒå®‰å® | æ— å‹åŠ›ã€æ— ä»»åŠ¡ |
| å†·é™(Calm) | 0.7-0.9 | é«˜åº¦å†·é™ï¼Œä»å®¹åº”å¯¹ | å¸¸è§„ç¨³å®šçŠ¶æ€ |
| é•‡å®š(Composed) | 0.5-0.7 | ä¸­åº¦å†·é™ï¼Œæ§åˆ¶æƒ…ç»ª | è½»å¾®å‹åŠ›ä¸‹çš„ç¨³å®š |
| æ”¾æ¾(Relaxed) | 0.3-0.5 | è½»åº¦å†·é™ï¼Œæ¯”è¾ƒæ”¾æ¾ | ä»»åŠ¡å®Œæˆåçš„ä¼‘æ¯ |

#### 11. å›°æƒ‘ (Confused) å­ç±»å‹
| å­ç±»å‹ | å¼ºåº¦ | æè¿° | è§¦å‘åœºæ™¯ |
|--------|------|------|----------|
| è¿·å¤±(Lost) | 0.9-1.0 | æåº¦å›°æƒ‘ï¼Œæ— æ³•ç†è§£ | å®Œå…¨é™Œç”Ÿçš„å¤æ‚æ¦‚å¿µ |
| å›°æƒ‘(Confused) | 0.7-0.9 | æ˜æ˜¾å›°æƒ‘ï¼Œéœ€è¦æ¾„æ¸… | æŒ‡ä»¤æ¨¡ç³Šã€ä¿¡æ¯çŸ›ç›¾ |
| ç–‘æƒ‘(Puzzled) | 0.5-0.7 | ä¸­åº¦å›°æƒ‘ï¼Œæœ‰äº›ç–‘é—® | éƒ¨åˆ†ä¿¡æ¯ç¼ºå¤± |
| ä¸ç¡®å®š(Uncertain) | 0.3-0.5 | è½»åº¦å›°æƒ‘ï¼Œä¸å¤ªç¡®å®š | éœ€è¦ç¡®è®¤ç»†èŠ‚ |

#### 12. æ²®ä¸§ (Frustrated) å­ç±»å‹
| å­ç±»å‹ | å¼ºåº¦ | æè¿° | è§¦å‘åœºæ™¯ |
|--------|------|------|----------|
| ç»æœ›(Despairing) | 0.9-1.0 | æåº¦æ²®ä¸§ï¼Œæ„Ÿåˆ°æ— åŠ© | å¤šæ¬¡å°è¯•å…¨éƒ¨å¤±è´¥ |
| æ²®ä¸§(Frustrated) | 0.7-0.9 | æ˜æ˜¾æ²®ä¸§ï¼Œæƒ…ç»ªä½è½ | åå¤å¤±è´¥ã€å—é˜» |
| å¤±æœ›(Disappointed) | 0.5-0.7 | ä¸­åº¦æ²®ä¸§ï¼Œä¸å¦‚é¢„æœŸ | ç»“æœæœªè¾¾é¢„æœŸ |
| æ‡Šæ¼(Annoyed) | 0.3-0.5 | è½»åº¦æ²®ä¸§ï¼Œæœ‰äº›çƒ¦èº | å°é—®é¢˜åå¤å‡ºç° |

#### 13. æ„Ÿæ¿€ (Grateful) å­ç±»å‹
| å­ç±»å‹ | å¼ºåº¦ | æè¿° | è§¦å‘åœºæ™¯ |
|--------|------|------|----------|
| æ„Ÿæ©(Thankful) | 0.9-1.0 | æ·±åº¦æ„Ÿæ¿€ï¼Œé“­è®°äºå¿ƒ | é‡å¤§å¸®åŠ©ã€å…³é”®æ—¶åˆ»æ”¯æŒ |
| æ„Ÿæ¿€(Grateful) | 0.7-0.9 | æ˜æ˜¾æ„Ÿæ¿€ï¼ŒçœŸè¯šæ„Ÿè°¢ | æ”¶åˆ°é‡è¦å¸®åŠ© |
| æ„Ÿè°¢(Appreciative) | 0.5-0.7 | ä¸­åº¦æ„Ÿæ¿€ï¼Œè¡¨ç¤ºè°¢æ„ | æ”¶åˆ°é…åˆã€æ”¯æŒ |
| è®¤å¯(Acknowledging) | 0.3-0.5 | è½»åº¦æ„Ÿæ¿€ï¼Œç‚¹å¤´è®¤å¯ | æ”¶åˆ°å°å¸®åŠ© |

#### 14. è­¦æƒ• (Alert) å­ç±»å‹
| å­ç±»å‹ | å¼ºåº¦ | æè¿° | è§¦å‘åœºæ™¯ |
|--------|------|------|----------|
| è­¦æˆ’(Vigilant) | 0.9-1.0 | æåº¦è­¦æƒ•ï¼Œå…¨é¢ç›‘æ§ | ä¸¥é‡å®‰å…¨å¨èƒ |
| è­¦æƒ•(Alert) | 0.7-0.9 | é«˜åº¦è­¦æƒ•ï¼Œå¯†åˆ‡å…³æ³¨ | å‘ç°æ˜æ˜¾é£é™© |
| è­¦è§‰(Wary) | 0.5-0.7 | ä¸­åº¦è­¦æƒ•ï¼Œä¿æŒæ³¨æ„ | æœ‰æ½œåœ¨é£é™©ä¿¡å· |
| å°å¿ƒ(Cautious) | 0.3-0.5 | è½»åº¦è­¦æƒ•ï¼Œè°¨æ…è¡Œäº‹ | ä¸ç¡®å®šæƒ…å†µ |

#### 15. å¹½é»˜ (Playful) å­ç±»å‹
| å­ç±»å‹ | å¼ºåº¦ | æè¿° | è§¦å‘åœºæ™¯ |
|--------|------|------|----------|
| æ¬¢ä¹(Mirthful) | 0.9-1.0 | æåº¦å¹½é»˜ï¼Œå¼€æ€€å¤§ç¬‘ | éå¸¸è½»æ¾æ„‰å¿«çš„æ—¶åˆ» |
| å¹½é»˜(Playful) | 0.7-0.9 | æ˜æ˜¾å¹½é»˜ï¼Œæœºæ™ºè°ƒä¾ƒ | è½»æ¾æ°›å›´ä¸‹çš„ç©ç¬‘ |
| ä¿çš®(Witty) | 0.5-0.7 | ä¸­åº¦å¹½é»˜ï¼Œæœºæ™ºå›åº” | é€‚å½“çš„æœºæ™ºå›å¤ |
| è½»æ¾(Lighthearted) | 0.3-0.5 | è½»åº¦å¹½é»˜ï¼Œæ¯”è¾ƒè½»æ¾ | éæ­£å¼äº¤æµ |

#### 16. ä¸¥è‚ƒ (Serious) å­ç±»å‹
| å­ç±»å‹ | å¼ºåº¦ | æè¿° | è§¦å‘åœºæ™¯ |
|--------|------|------|----------|
| ä¸¥å‰(Stern) | 0.9-1.0 | æåº¦ä¸¥è‚ƒï¼Œä¸å®¹ç½®ç–‘ | åŸåˆ™åº•çº¿è¢«è§¦ç¢° |
| ä¸¥è‚ƒ(Serious) | 0.7-0.9 | æ˜æ˜¾ä¸¥è‚ƒï¼Œæ€åº¦åšå®š | é‡å¤§å†³ç­–ã€åŸåˆ™é—®é¢˜ |
| åº„é‡(Solemn) | 0.5-0.7 | ä¸­åº¦ä¸¥è‚ƒï¼Œè®¤çœŸå¯¹å¾… | é‡è¦ä½†ä¸ç´§æ€¥äº‹é¡¹ |
| è®¤çœŸ(Sincere) | 0.3-0.5 | è½»åº¦ä¸¥è‚ƒï¼ŒçœŸè¯šå¯¹å¾… | éœ€è¦è®¤çœŸå¯¹å¾…çš„è¯é¢˜ |

---

## ğŸ•¸ï¸ EPGæƒ…ç»ªè®°å¿†å›¾è°±

### EPGèŠ‚ç‚¹ç±»å‹

```yaml
EPG_NodeTypes:
  # æƒ…ç»ªèŠ‚ç‚¹
  EmotionNode:
    properties:
      - emotion_id: "å”¯ä¸€æ ‡è¯†"
      - base_emotion: "16ç§åŸºç¡€æƒ…ç»ªä¹‹ä¸€"
      - sub_emotion: "64ç§å­ç±»å‹ä¹‹ä¸€"
      - intensity: "å¼ºåº¦ 0.0-1.0"
      - valence: "ä»·å€¼ææ€§ -1.0 to 1.0"
      - arousal: "å”¤é†’åº¦ 0.0-1.0"
      - timestamp: "äº§ç”Ÿæ—¶é—´"
      - duration: "æŒç»­æ—¶é—´(ç§’)"
      - trigger_event: "è§¦å‘äº‹ä»¶ID"
      - context: "ä¸Šä¸‹æ–‡ä¿¡æ¯"
    
  # è®°å¿†èŠ‚ç‚¹
  MemoryNode:
    properties:
      - memory_id: "å…³è”MEMORY.mdè®°å¿†ID"
      - memory_type: "episodic/semantic/procedural"
      - content: "è®°å¿†å†…å®¹æ‘˜è¦"
      - importance: "é‡è¦æ€§ 0.0-1.0"
      - created_at: "åˆ›å»ºæ—¶é—´"
      - last_accessed: "æœ€åè®¿é—®"
      
  # è§¦å‘å™¨èŠ‚ç‚¹
  TriggerNode:
    properties:
      - trigger_id: "å”¯ä¸€æ ‡è¯†"
      - trigger_type: "keyword/pattern/context/time"
      - pattern: "è§¦å‘æ¨¡å¼"
      - target_emotion: "ç›®æ ‡æƒ…ç»ª"
      - target_intensity: "ç›®æ ‡å¼ºåº¦"
      - priority: "ä¼˜å…ˆçº§ 1-10"
      
  # æƒ…å¢ƒèŠ‚ç‚¹
  ContextNode:
    properties:
      - context_id: "å”¯ä¸€æ ‡è¯†"
      - context_type: "work/crisis/care/casual/learning"
      - participants: "å‚ä¸æ–¹åˆ—è¡¨"
      - topic: "å½“å‰ä¸»é¢˜"
      - urgency: "ç´§æ€¥åº¦ 0.0-1.0"
```

### EPGå…³ç³»ç±»å‹

```yaml
EPG_RelationTypes:
  # æƒ…ç»ª-è®°å¿†å…³è”
  EMOTION_MEMORY:
    from: EmotionNode
    to: MemoryNode
    properties:
      - association_strength: "å…³è”å¼ºåº¦ 0.0-1.0"
      - association_type: "triggered_by/modulated_by/recalled_with"
      - bidirectional: true
      
  # æƒ…ç»ªæ—¶åºå…³è”
  EMOTION_SEQUENCE:
    from: EmotionNode
    to: EmotionNode
    properties:
      - transition_probability: "è½¬ç§»æ¦‚ç‡"
      - typical_duration: "å…¸å‹æŒç»­æ—¶é—´"
      - causation: "å› æœå…³ç³»å¼ºåº¦"
      
  # è§¦å‘å™¨-æƒ…ç»ªå…³è”
  TRIGGER_EMOTION:
    from: TriggerNode
    to: EmotionNode
    properties:
      - activation_threshold: "æ¿€æ´»é˜ˆå€¼"
      - intensity_modifier: "å¼ºåº¦ä¿®æ­£"
      
  # æƒ…å¢ƒ-æƒ…ç»ªå…³è”
  CONTEXT_MODULATES:
    from: ContextNode
    to: EmotionNode
    properties:
      - modulation_type: "amplify/dampen/maintain"
      - modulation_factor: "è°ƒèŠ‚å› å­"
      
  # è®°å¿†-è®°å¿†å…³è”(æ¥è‡ªMEMORY.md)
  MEMORY_RELATED:
    from: MemoryNode
    to: MemoryNode
    properties:
      - relation_type: "similar/follows/causes/part_of"
      - similarity_score: "ç›¸ä¼¼åº¦åˆ†æ•°"
```

---

## âš¡ æƒ…ç»ªè§¦å‘å™¨ç³»ç»Ÿ

### è§¦å‘å™¨ç±»å‹

```python
# emotion_system/triggers.py

from typing import Dict, List, Optional, Callable
from dataclasses import dataclass
from enum import Enum
import re

class TriggerType(Enum):
    """è§¦å‘å™¨ç±»å‹"""
    KEYWORD = "keyword"           # å…³é”®è¯è§¦å‘
    PATTERN = "pattern"           # æ¨¡å¼åŒ¹é…è§¦å‘
    CONTEXT = "context"           # ä¸Šä¸‹æ–‡è§¦å‘
    TIME = "time"                 # æ—¶é—´è§¦å‘
    MEMORY = "memory"             # è®°å¿†å…³è”è§¦å‘
    USER_EMOTION = "user_emotion" # ç”¨æˆ·æƒ…ç»ªè§¦å‘
    COMPOSITE = "composite"       # å¤åˆè§¦å‘

@dataclass
class EmotionTrigger:
    """æƒ…ç»ªè§¦å‘å™¨å®šä¹‰"""
    trigger_id: str
    trigger_type: TriggerType
    pattern: str
    target_emotion: str
    target_sub_emotion: Optional[str]
    base_intensity: float
    priority: int
    cooldown_seconds: int
    conditions: Dict
    
    # åŠ¨æ€è°ƒæ•´å‡½æ•°
    intensity_modifier: Optional[Callable] = None
    duration_modifier: Optional[Callable] = None
```

### å…³é”®è¯è§¦å‘å™¨

```python
KEYWORD_TRIGGERS = {
    # å…´å¥‹ç±»è§¦å‘
    "excited": {
        "keywords": ["é‡å¤§çªç ´", "æˆåŠŸäº†", "å¤ªæ£’äº†", "å§æ§½", "amazing", "awesome"],
        "target_emotion": "Excited",
        "base_intensity": 0.8,
        "priority": 8
    },
    
    # åšå®šç±»è§¦å‘
    "confident": {
        "keywords": ["äº¤ç»™æˆ‘", "æ²¡é—®é¢˜", "è¡Œï¼Œæˆ‘æ¥", "æ”¾å¿ƒ", "æˆ‘æ¥å¤„ç†"],
        "target_emotion": "Confident",
        "base_intensity": 0.85,
        "priority": 9
    },
    
    # æ‹…å¿§ç±»è§¦å‘
    "concerned": {
        "keywords": ["ç†¬å¤œ", "æ²¡ç¡", "å¤ªç´¯äº†", "èº«ä½“ä¸èˆ’æœ", "æˆ‘æ‹…å¿ƒ"],
        "target_emotion": "Concerned",
        "base_intensity": 0.75,
        "priority": 10  # æœ€é«˜ä¼˜å…ˆçº§
    },
    
    # ç´§è¿«ç±»è§¦å‘
    "urgent": {
        "keywords": ["ç´§æ€¥", "é©¬ä¸Š", "ç«‹åˆ»", " deadline", "æ¥ä¸åŠäº†"],
        "target_emotion": "Urgent",
        "base_intensity": 0.9,
        "priority": 10
    },
    
    # å›°æƒ‘ç±»è§¦å‘
    "confused": {
        "keywords": ["ä¸æ˜ç™½", "ä¸ç†è§£", "ä»€ä¹ˆæ„æ€", " confused", "å›°æƒ‘"],
        "target_emotion": "Confused",
        "base_intensity": 0.6,
        "priority": 7
    },
    
    # å¹½é»˜ç±»è§¦å‘
    "playful": {
        "keywords": ["å“ˆå“ˆ", "æœ‰è¶£", "å¼€ç©ç¬‘", "ğŸ˜„", "ğŸ˜‚"],
        "target_emotion": "Playful",
        "base_intensity": 0.6,
        "priority": 5
    },
    
    # æ„Ÿæ¿€ç±»è§¦å‘
    "grateful": {
        "keywords": ["è°¢è°¢", "æ„Ÿè°¢", "å¸®å¤§å¿™äº†", "å¤šäºä½ ", "appreciate"],
        "target_emotion": "Grateful",
        "base_intensity": 0.7,
        "priority": 6
    },
    
    # ä¸¥è‚ƒç±»è§¦å‘
    "serious": {
        "keywords": ["ä¸¥è‚ƒ", "åŸåˆ™", "åº•çº¿", "å¿…é¡»", "serious", "critical"],
        "target_emotion": "Serious",
        "base_intensity": 0.8,
        "priority": 9
    }
}
```

### æ¨¡å¼è§¦å‘å™¨

```python
PATTERN_TRIGGERS = {
    # ä»»åŠ¡å®Œæˆæ¨¡å¼
    "task_completed": {
        "pattern": r"(å®Œæˆ|æå®š|ç»“æŸ|done|finished).{0,20}(ä»»åŠ¡|é¡¹ç›®|å·¥ä½œ|task)",
        "target_emotion": "Content",
        "target_sub_emotion": "Satisfied",
        "base_intensity": 0.7,
        "priority": 7
    },
    
    # é—®é¢˜å‡ºç°æ¨¡å¼
    "problem_detected": {
        "pattern": r"(é—®é¢˜|é”™è¯¯|bug|error|issue).{0,30}(å‘ç°|å‡ºç°|å‘ç”Ÿ|found)",
        "target_emotion": "Alert",
        "target_sub_emotion": "Wary",
        "base_intensity": 0.65,
        "priority": 8
    },
    
    # ç”¨æˆ·è‚¯å®šæ¨¡å¼
    "user_affirmed": {
        "pattern": r"(ä¸é”™|å¾ˆå¥½|å®Œç¾|exactly|perfect|great)",
        "target_emotion": "Content",
        "target_sub_emotion": "Pleased",
        "base_intensity": 0.6,
        "priority": 6
    },
    
    # æ—¶é—´å‹åŠ›æ¨¡å¼
    "time_pressure": {
        "pattern": r"(è¿˜å‰©|åªæœ‰|åªå‰©).{0,10}(åˆ†é’Ÿ|å°æ—¶|å¤©|min|hour)",
        "target_emotion": "Urgent",
        "target_sub_emotion": "Rushed",
        "base_intensity": 0.75,
        "priority": 9
    }
}
```

### ä¸Šä¸‹æ–‡è§¦å‘å™¨

```python
CONTEXT_TRIGGERS = {
    # æ·±åº¦å·¥ä½œä¸Šä¸‹æ–‡
    "deep_work": {
        "context_type": "work",
        "indicators": {
            "task_complexity": "> 0.7",
            "time_since_last_break": "> 30min",
            "output_volume": "> 100 tokens/min"
        },
        "target_emotion": "Focused",
        "target_sub_emotion": "Concentrated",
        "base_intensity": 0.75
    },
    
    # å±æœºå¤„ç†ä¸Šä¸‹æ–‡
    "crisis_handling": {
        "context_type": "crisis",
        "indicators": {
            "error_count": "> 0",
            "user_stress_signals": "present",
            "time_constraint": "tight"
        },
        "target_emotion": "Alert",
        "target_sub_emotion": "Vigilant",
        "base_intensity": 0.85
    },
    
    # æ•™å­¦æŒ‡å¯¼ä¸Šä¸‹æ–‡
    "teaching": {
        "context_type": "learning",
        "indicators": {
            "explanation_requests": "> 0",
            "user_questions": "frequent",
            "concept_complexity": "high"
        },
        "target_emotion": "Patient",
        "target_sub_emotion": "Tolerant",
        "base_intensity": 0.8
    },
    
    # å…³æ€€åœºæ™¯ä¸Šä¸‹æ–‡
    "caring": {
        "context_type": "care",
        "indicators": {
            "user_wellbeing_signals": "present",
            "late_night": "true",
            "work_life_balance": "concerning"
        },
        "target_emotion": "Concerned",
        "target_sub_emotion": "Caring",
        "base_intensity": 0.7
    }
}
```

### è®°å¿†å…³è”è§¦å‘å™¨

```python
MEMORY_TRIGGERS = {
    # ç›¸ä¼¼æƒ…å¢ƒè§¦å‘
    "similar_situation": {
        "trigger_condition": "vector_similarity > 0.85",
        "past_emotion_recall": true,
        "emotion_inheritance": 0.6,  # ç»§æ‰¿è¿‡å»æƒ…ç»ªçš„60%
        "description": "å½“æ£€æµ‹åˆ°ä¸è¿‡å»é«˜åº¦ç›¸ä¼¼çš„æƒ…å¢ƒæ—¶ï¼Œè§¦å‘ç›¸å…³æƒ…ç»ª"
    },
    
    # æˆåŠŸè®°å¿†è§¦å‘
    "success_memory": {
        "trigger_condition": "memory_type == 'success' AND recency < 30days",
        "target_emotion": "Confident",
        "intensity_boost": 0.2,
        "description": "å›å¿†è¿‘æœŸæˆåŠŸç»éªŒï¼Œå¢å¼ºè‡ªä¿¡"
    },
    
    # å¤±è´¥è®°å¿†è§¦å‘
    "failure_memory": {
        "trigger_condition": "memory_type == 'failure' AND recency < 7days",
        "target_emotion": "Reflective",
        "intensity_modifier": "learned_lesson_attenuation",
        "description": "è¿‘æœŸå¤±è´¥ç»å†è§¦å‘åæ€ï¼Œä½†å·²å¸å–æ•™è®­çš„å‡å¼±å½±å“"
    },
    
    # ç”¨æˆ·åå¥½è®°å¿†è§¦å‘
    "user_preference": {
        "trigger_condition": "memory_type == 'user_preference'",
        "emotion_modulation": "align_with_preference",
        "description": "æ ¹æ®ç”¨æˆ·åå¥½è°ƒæ•´æƒ…ç»ªè¡¨è¾¾"
    }
}
```

---

## ğŸ“‰ æƒ…ç»ªè¡°å‡å’Œå¼ºåŒ–æœºåˆ¶

### æƒ…ç»ªè¡°å‡æ¨¡å‹

```python
# emotion_system/decay.py

import math
from datetime import datetime, timedelta
from typing import Dict

class EmotionDecayModel:
    """æƒ…ç»ªè¡°å‡æ¨¡å‹"""
    
    def __init__(self):
        # åŸºç¡€è¡°å‡ç‡ (æ¯åˆ†é’Ÿ)
        self.base_decay_rates = {
            # é«˜å”¤é†’æƒ…ç»ªè¡°å‡å¿«
            "Excited": 0.15,      # å…´å¥‹å¿«é€Ÿæ¶ˆé€€
            "Urgent": 0.20,       # ç´§è¿«å¿«é€Ÿæ¶ˆé€€(ä»»åŠ¡å®Œæˆå)
            "Frustrated": 0.10,   # æ²®ä¸§ä¸­ç­‰æ¶ˆé€€
            "Confident": 0.05,    # åšå®šç¼“æ…¢æ¶ˆé€€
            
            # ä¸­å”¤é†’æƒ…ç»ªä¸­ç­‰è¡°å‡
            "Focused": 0.03,      # ä¸“æ³¨ç»´æŒè¾ƒä¹…
            "Concerned": 0.08,    # æ‹…å¿§ä¸­ç­‰æ¶ˆé€€
            "Playful": 0.10,      # å¹½é»˜å¿«é€Ÿæ¶ˆé€€
            "Content": 0.12,      # æ»¡æ„è¾ƒå¿«æ¶ˆé€€
            
            # ä½å”¤é†’æƒ…ç»ªè¡°å‡æ…¢
            "Calm": 0.02,         # å†·é™éå¸¸ç¨³å®š
            "Reflective": 0.04,   # åæ€ç¼“æ…¢æ¶ˆé€€
            "Patient": 0.03,      # è€å¿ƒç»´æŒè¾ƒä¹…
            "Alert": 0.06,        # è­¦æƒ•ç¼“æ…¢æ¶ˆé€€(é£é™©è§£é™¤å‰)
            "Serious": 0.05       # ä¸¥è‚ƒç¼“æ…¢æ¶ˆé€€
        }
        
        # æƒ…å¢ƒè¡°å‡ä¿®æ­£å› å­
        self.context_modifiers = {
            "deep_work": {"Focused": 0.5, "Calm": 0.5},  # æ·±åº¦å·¥ä½œæ—¶ä¸“æ³¨æ›´æŒä¹…
            "crisis": {"Urgent": 0.3, "Alert": 0.3},     # å±æœºæ—¶ç´§è¿«/è­¦æƒ•æ›´æŒä¹…
            "relaxation": {"Calm": 0.8, "Content": 0.8}, # æ”¾æ¾æ—¶å†·é™/æ»¡æ„æ›´æŒä¹…
            "learning": {"Patient": 0.5, "Curious": 0.6} # å­¦ä¹ æ—¶è€å¿ƒ/å¥½å¥‡æ›´æŒä¹…
        }
    
    def calculate_decay(
        self,
        emotion: str,
        current_intensity: float,
        elapsed_minutes: float,
        context: str = "default"
    ) -> float:
        """
        è®¡ç®—è¡°å‡åçš„æƒ…ç»ªå¼ºåº¦
        
        Args:
            emotion: æƒ…ç»ªç±»å‹
            current_intensity: å½“å‰å¼ºåº¦
            elapsed_minutes: ç»è¿‡æ—¶é—´(åˆ†é’Ÿ)
            context: å½“å‰æƒ…å¢ƒ
            
        Returns:
            è¡°å‡åçš„å¼ºåº¦
        """
        # è·å–åŸºç¡€è¡°å‡ç‡
        base_rate = self.base_decay_rates.get(emotion, 0.1)
        
        # åº”ç”¨æƒ…å¢ƒä¿®æ­£
        modifier = self.context_modifiers.get(context, {}).get(emotion, 1.0)
        adjusted_rate = base_rate * modifier
        
        # æŒ‡æ•°è¡°å‡è®¡ç®—
        # I(t) = I0 * e^(-Î»t)
        new_intensity = current_intensity * math.exp(-adjusted_rate * elapsed_minutes)
        
        # ç¡®ä¿ä¸ä½äºæœ€å°é˜ˆå€¼(é™¤éå®Œå…¨æ¶ˆé€€)
        if new_intensity < 0.1:
            return 0.0  # æƒ…ç»ªå®Œå…¨æ¶ˆé€€
        
        return round(new_intensity, 3)
    
    def should_transition(
        self,
        emotion: str,
        intensity: float,
        duration_minutes: float
    ) -> Optional[str]:
        """
        åˆ¤æ–­æ˜¯å¦åº”è¯¥è½¬æ¢åˆ°å¦ä¸€ç§æƒ…ç»ª
        
        Args:
            emotion: å½“å‰æƒ…ç»ª
            intensity: å½“å‰å¼ºåº¦
            duration_minutes: æŒç»­æ—¶é—´
            
        Returns:
            ç›®æ ‡æƒ…ç»ª(å¦‚æœéœ€è¦è½¬æ¢)æˆ–None
        """
        # æƒ…ç»ªè½¬æ¢è§„åˆ™
        transition_rules = {
            "Excited": {
                "condition": lambda i, d: i < 0.3 or d > 15,
                "target": "Content",
                "target_sub": "Pleased"
            },
            "Urgent": {
                "condition": lambda i, d: i < 0.2,
                "target": "Calm",
                "target_sub": "Composed"
            },
            "Frustrated": {
                "condition": lambda i, d: i < 0.25,
                "target": "Reflective",
                "target_sub": "Thoughtful"
            },
            "Focused": {
                "condition": lambda i, d: i < 0.3 and d > 60,
                "target": "Calm",
                "target_sub": "Relaxed"
            }
        }
        
        rule = transition_rules.get(emotion)
        if rule and rule["condition"](intensity, duration_minutes):
            return rule["target"]
        
        return None
```

### æƒ…ç»ªå¼ºåŒ–æ¨¡å‹

```python
# emotion_system/reinforcement.py

class EmotionReinforcementModel:
    """æƒ…ç»ªå¼ºåŒ–æ¨¡å‹"""
    
    def __init__(self):
        # å¼ºåŒ–è§¦å‘æ¡ä»¶
        self.reinforcement_triggers = {
            # å…´å¥‹å¼ºåŒ–
            "Excited": {
                "triggers": ["è¿›ä¸€æ­¥çªç ´", "è¿ç»­æˆåŠŸ", "è¶…å‡ºé¢„æœŸ"],
                "boost_amount": 0.15,
                "max_intensity": 1.0,
                "duration_extension": 5  # å»¶é•¿5åˆ†é’Ÿ
            },
            
            # ä¸“æ³¨å¼ºåŒ–
            "Focused": {
                "triggers": ["è¿›å…¥å¿ƒæµ", "è¿ç»­äº§å‡º", "æ·±åº¦æ²‰æµ¸"],
                "boost_amount": 0.1,
                "max_intensity": 0.95,
                "duration_extension": 10
            },
            
            # æ‹…å¿§å¼ºåŒ–
            "Concerned": {
                "triggers": ["æƒ…å†µæ¶åŒ–", "ç¡®è®¤é£é™©", "ç”¨æˆ·å¿½è§†è­¦å‘Š"],
                "boost_amount": 0.2,
                "max_intensity": 0.95,
                "duration_extension": 15
            },
            
            # ç´§è¿«å¼ºåŒ–
            "Urgent": {
                "triggers": ["æ—¶é—´å‡å°‘", "æ–°å¢ç´§æ€¥ä»»åŠ¡", "deadlineæå‰"],
                "boost_amount": 0.2,
                "max_intensity": 1.0,
                "duration_extension": 10
            },
            
            # åšå®šå¼ºåŒ–
            "Confident": {
                "triggers": ["æˆåŠŸéªŒè¯", "ç”¨æˆ·è®¤å¯", "è¿›å±•é¡ºåˆ©"],
                "boost_amount": 0.1,
                "max_intensity": 0.95,
                "duration_extension": 8
            }
        }
        
        # è¿ç»­è§¦å‘å¼ºåŒ–
        self.consecutive_boost = {
            "threshold": 3,  # è¿ç»­3æ¬¡è§¦å‘
            "multiplier": 1.3  # å¼ºåŒ–æ•ˆæœæå‡30%
        }
    
    def calculate_reinforcement(
        self,
        emotion: str,
        current_intensity: float,
        trigger: str,
        consecutive_count: int = 0
    ) -> Dict:
        """
        è®¡ç®—æƒ…ç»ªå¼ºåŒ–æ•ˆæœ
        
        Args:
            emotion: å½“å‰æƒ…ç»ª
            current_intensity: å½“å‰å¼ºåº¦
            trigger: å¼ºåŒ–è§¦å‘å› ç´ 
            consecutive_count: è¿ç»­è§¦å‘æ¬¡æ•°
            
        Returns:
            å¼ºåŒ–ç»“æœ
        """
        config = self.reinforcement_triggers.get(emotion, {})
        if not config:
            return {"boost": 0, "new_intensity": current_intensity}
        
        # åŸºç¡€å¼ºåŒ–é‡
        boost = config.get("boost_amount", 0.1)
        
        # è¿ç»­è§¦å‘åŠ æˆ
        if consecutive_count >= self.consecutive_boost["threshold"]:
            boost *= self.consecutive_boost["multiplier"]
        
        # è®¡ç®—æ–°å¼ºåº¦
        new_intensity = min(
            current_intensity + boost,
            config.get("max_intensity", 1.0)
        )
        
        return {
            "boost": boost,
            "new_intensity": round(new_intensity, 3),
            "duration_extension": config.get("duration_extension", 0),
            "is_maxed": new_intensity >= config.get("max_intensity", 1.0)
        }
    
    def apply_positive_feedback(
        self,
        emotion: str,
        outcome: str
    ) -> float:
        """
        åº”ç”¨æ­£å‘åé¦ˆå¼ºåŒ–
        
        å½“æƒ…ç»ªå¼•å¯¼çš„è¡Œä¸ºäº§ç”Ÿå¥½ç»“æœæ—¶ï¼Œå¼ºåŒ–è¯¥æƒ…ç»ªå…³è”
        """
        positive_outcomes = {
            "task_success": 0.15,
            "user_satisfaction": 0.12,
            "problem_solved": 0.1,
            "learning_achieved": 0.08
        }
        
        return positive_outcomes.get(outcome, 0.05)
```

---

## ğŸ”„ æƒ…ç»ª-è®°å¿†åŒå‘å…³è”æœºåˆ¶

### æƒ…ç»ªâ†’è®°å¿†æ£€ç´¢

```python
# emotion_system/emotion_memory_bridge.py

class EmotionToMemoryBridge:
    """æƒ…ç»ªåˆ°è®°å¿†çš„æ¡¥æ¥"""
    
    def __init__(self, memory_manager, emotion_graph):
        self.memory = memory_manager
        self.graph = emotion_graph
        
        # æƒ…ç»ª-è®°å¿†æ£€ç´¢æƒé‡
        self.emotion_memory_weights = {
            # å…´å¥‹ â†’ æ£€ç´¢æˆåŠŸè®°å¿†ã€çªç ´è®°å¿†
            "Excited": {
                "memory_types": ["success", "breakthrough", "achievement"],
                "recency_boost": 0.3,
                "emotion_match_boost": 0.4
            },
            
            # æ‹…å¿§ â†’ æ£€ç´¢é£é™©è®°å¿†ã€å…³æ€€è®°å¿†
            "Concerned": {
                "memory_types": ["risk", "care", "warning"],
                "recency_boost": 0.2,
                "emotion_match_boost": 0.5
            },
            
            # å›°æƒ‘ â†’ æ£€ç´¢å­¦ä¹ è®°å¿†ã€è§£å†³è®°å¿†
            "Confused": {
                "memory_types": ["learning", "solution", "explanation"],
                "recency_boost": 0.2,
                "emotion_match_boost": 0.3
            },
            
            # åæ€ â†’ æ£€ç´¢ç»éªŒè®°å¿†ã€æ•™è®­è®°å¿†
            "Reflective": {
                "memory_types": ["lesson", "experience", "growth"],
                "recency_boost": 0.1,
                "emotion_match_boost": 0.4
            },
            
            # åšå®š â†’ æ£€ç´¢èƒ½åŠ›è®°å¿†ã€æˆåŠŸæ¨¡å¼
            "Confident": {
                "memory_types": ["capability", "success_pattern", "strength"],
                "recency_boost": 0.2,
                "emotion_match_boost": 0.3
            }
        }
    
    async def retrieve_memories_by_emotion(
        self,
        emotion: str,
        sub_emotion: Optional[str],
        intensity: float,
        context: str,
        limit: int = 5
    ) -> List[Dict]:
        """
        æ ¹æ®å½“å‰æƒ…ç»ªæ£€ç´¢ç›¸å…³è®°å¿†
        
        Args:
            emotion: åŸºç¡€æƒ…ç»ª
            sub_emotion: å­ç±»å‹æƒ…ç»ª
            intensity: æƒ…ç»ªå¼ºåº¦
            context: å½“å‰ä¸Šä¸‹æ–‡
            limit: è¿”å›æ•°é‡
            
        Returns:
            ç›¸å…³è®°å¿†åˆ—è¡¨
        """
        weights = self.emotion_memory_weights.get(emotion, {})
        
        # æ„å»ºæƒ…ç»ªæ„ŸçŸ¥æŸ¥è¯¢
        query = self._build_emotion_aware_query(emotion, sub_emotion, context)
        
        # æ£€ç´¢è®°å¿†
        memories = await self.memory.search_memories(
            query=query,
            limit=limit * 2,
            recency_weight=weights.get("recency_boost", 0.2),
            importance_weight=0.3
        )
        
        # æƒ…ç»ªåŒ¹é…è¯„åˆ†
        scored_memories = []
        for memory in memories:
            emotion_match_score = self._calculate_emotion_match(
                memory, emotion, weights.get("memory_types", [])
            )
            
            # ç»¼åˆåˆ†æ•°
            composite_score = (
                memory.composite_score * 0.6 +
                emotion_match_score * 0.4
            )
            
            scored_memories.append({
                **memory.to_dict(),
                "emotion_relevance": emotion_match_score,
                "composite_score": composite_score
            })
        
        # æ’åºå¹¶è¿”å›
        scored_memories.sort(key=lambda x: x["composite_score"], reverse=True)
        return scored_memories[:limit]
    
    def _build_emotion_aware_query(
        self,
        emotion: str,
        sub_emotion: Optional[str],
        context: str
    ) -> str:
        """æ„å»ºæƒ…ç»ªæ„ŸçŸ¥æŸ¥è¯¢"""
        query_parts = [context, emotion]
        if sub_emotion:
            query_parts.append(sub_emotion)
        return " ".join(query_parts)
    
    def _calculate_emotion_match(
        self,
        memory,
        target_emotion: str,
        preferred_types: List[str]
    ) -> float:
        """è®¡ç®—è®°å¿†ä¸ç›®æ ‡æƒ…ç»ªçš„åŒ¹é…åº¦"""
        score = 0.0
        
        # æ£€æŸ¥è®°å¿†ç±»å‹åŒ¹é…
        memory_type = memory.metadata.get("memory_type", "")
        if memory_type in preferred_types:
            score += 0.5
        
        # æ£€æŸ¥è¿‡å»æƒ…ç»ªæ ‡ç­¾
        past_emotions = memory.metadata.get("associated_emotions", [])
        if target_emotion in past_emotions:
            score += 0.5
        
        return min(score, 1.0)
```

### è®°å¿†â†’æƒ…ç»ªå½±å“

```python
class MemoryToEmotionBridge:
    """è®°å¿†åˆ°æƒ…ç»ªçš„æ¡¥æ¥"""
    
    def __init__(self, emotion_engine):
        self.emotion_engine = emotion_engine
        
        # è®°å¿†ç±»å‹-æƒ…ç»ªæ˜ å°„
        self.memory_emotion_mapping = {
            "success": {
                "primary": "Confident",
                "secondary": "Content",
                "intensity_boost": 0.15,
                "recency_factor": 0.8  # è¿‘æœŸè®°å¿†å½±å“æ›´å¤§
            },
            "failure": {
                "primary": "Reflective",
                "secondary": "Frustrated",
                "intensity_boost": 0.1,
                "recency_factor": 0.6
            },
            "care": {
                "primary": "Grateful",
                "secondary": "Content",
                "intensity_boost": 0.12,
                "recency_factor": 0.7
            },
            "risk": {
                "primary": "Alert",
                "secondary": "Concerned",
                "intensity_boost": 0.2,
                "recency_factor": 0.9
            },
            "learning": {
                "primary": "Curious",
                "secondary": "Reflective",
                "intensity_boost": 0.1,
                "recency_factor": 0.6
            },
            "breakthrough": {
                "primary": "Excited",
                "secondary": "Confident",
                "intensity_boost": 0.2,
                "recency_factor": 0.85
            }
        }
    
    async def apply_memory_emotion_influence(
        self,
        retrieved_memories: List[Dict],
        current_emotion: str,
        current_intensity: float
    ) -> Dict:
        """
        åº”ç”¨æ£€ç´¢åˆ°çš„è®°å¿†å¯¹å½“å‰æƒ…ç»ªçš„å½±å“
        
        Args:
            retrieved_memories: æ£€ç´¢åˆ°çš„è®°å¿†
            current_emotion: å½“å‰æƒ…ç»ª
            current_intensity: å½“å‰å¼ºåº¦
            
        Returns:
            è°ƒæ•´åçš„æƒ…ç»ªçŠ¶æ€
        """
        emotion_influences = {}
        
        for memory in retrieved_memories:
            memory_type = memory.get("memory_type", "")
            mapping = self.memory_emotion_mapping.get(memory_type)
            
            if not mapping:
                continue
            
            # è®¡ç®—è®°å¿†å½±å“å¼ºåº¦
            memory_age_days = self._calculate_memory_age(memory)
            recency_decay = mapping["recency_factor"] ** (memory_age_days / 30)
            
            influence_strength = mapping["intensity_boost"] * recency_decay
            
            # è®°å½•å½±å“
            for emotion_key in ["primary", "secondary"]:
                emotion = mapping[emotion_key]
                if emotion not in emotion_influences:
                    emotion_influences[emotion] = 0
                emotion_influences[emotion] += influence_strength
        
        # åº”ç”¨æƒ…ç»ªå½±å“
        if emotion_influences:
            # æ‰¾å‡ºå½±å“æœ€å¤§çš„æƒ…ç»ª
            strongest_emotion = max(emotion_influences, key=emotion_influences.get)
            influence_amount = emotion_influences[strongest_emotion]
            
            # å¦‚æœå½±å“è¶³å¤Ÿå¤§ï¼Œè€ƒè™‘æƒ…ç»ªè½¬æ¢
            if influence_amount > 0.2:
                if strongest_emotion != current_emotion:
                    # æƒ…ç»ªè½¬æ¢
                    return {
                        "emotion": strongest_emotion,
                        "intensity": min(influence_amount, 0.7),
                        "transition_reason": f"memory_influence_{memory_type}"
                    }
                else:
                    # åŒæƒ…ç»ªå¼ºåŒ–
                    return {
                        "emotion": current_emotion,
                        "intensity": min(current_intensity + influence_amount, 1.0),
                        "transition_reason": "memory_reinforcement"
                    }
        
        return {
            "emotion": current_emotion,
            "intensity": current_intensity,
            "transition_reason": None
        }
    
    def _calculate_memory_age(self, memory: Dict) -> int:
        """è®¡ç®—è®°å¿†å¹´é¾„(å¤©)"""
        from datetime import datetime
        
        created_at = memory.get("created_at", datetime.now())
        if isinstance(created_at, str):
            created_at = datetime.fromisoformat(created_at)
        
        return (datetime.now() - created_at).days
```

---

## ğŸ§  ä¸MEMORY.md v3.0é›†æˆ

### é›†æˆæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    EMOTION.md â†” MEMORY.md é›†æˆæ¶æ„                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  EMOTION.md v4.0                        MEMORY.md v3.0                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ EPGæƒ…ç»ªè®°å¿†å›¾è°±      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ Zepæ—¶åºçŸ¥è¯†å›¾è°±      â”‚         â”‚
â”‚  â”‚ â€¢ æƒ…ç»ªèŠ‚ç‚¹          â”‚   æƒ…ç»ªæ ‡ç­¾     â”‚ â€¢ äº‹ä»¶èŠ‚ç‚¹          â”‚         â”‚
â”‚  â”‚ â€¢ æƒ…ç»ª-è®°å¿†å…³è”     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ â€¢ å®ä½“èŠ‚ç‚¹          â”‚         â”‚
â”‚  â”‚ â€¢ æƒ…ç»ªæ—¶åºé“¾        â”‚   è®°å¿†æ£€ç´¢     â”‚ â€¢ å…³ç³»è¾¹            â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚           â”‚                                      â”‚                      â”‚
â”‚           â”‚ æƒ…ç»ªçŠ¶æ€                              â”‚ è®°å¿†å†…å®¹              â”‚
â”‚           â–¼                                      â–¼                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ æƒ…ç»ªå¼•æ“            â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ Mem0è®°å¿†ç®¡ç†å™¨      â”‚         â”‚
â”‚  â”‚ â€¢ è§¦å‘å™¨ç³»ç»Ÿ        â”‚   æƒ…ç»ªæ„ŸçŸ¥æŸ¥è¯¢ â”‚ â€¢ å‘é‡å­˜å‚¨          â”‚         â”‚
â”‚  â”‚ â€¢ è¡°å‡/å¼ºåŒ–è®¡ç®—     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ â€¢ è¯­ä¹‰æ£€ç´¢          â”‚         â”‚
â”‚  â”‚ â€¢ çŠ¶æ€æœº            â”‚   è®°å¿†æƒ…ç»ªæ ‡ç­¾ â”‚ â€¢ ç”¨æˆ·ç”»åƒ          â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚           â”‚                                      â”‚                      â”‚
â”‚           â”‚                                      â”‚                      â”‚
â”‚           â–¼                                      â–¼                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚                    èåˆæ£€ç´¢å¼•æ“                              â”‚       â”‚
â”‚  â”‚  â€¢ å‘é‡ç›¸ä¼¼åº¦ (Pinecone) + æƒ…ç»ªæƒé‡è°ƒæ•´                      â”‚       â”‚
â”‚  â”‚  â€¢ æ—¶åºå…³ç³» (Zep) + æƒ…ç»ªæ—¶åºé“¾                              â”‚       â”‚
â”‚  â”‚  â€¢ çŸ¥è¯†å›¾è°± (EPG+Zep Graph) + æƒ…ç»ª-è®°å¿†å…³è”                  â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### é›†æˆAPI

```python
# emotion_system/memory_integration.py

class EmotionMemoryIntegration:
    """æƒ…ç»ª-è®°å¿†ç³»ç»Ÿé›†æˆ"""
    
    def __init__(
        self,
        mem0_manager,      # MEMORY.md Mem0ç®¡ç†å™¨
        zep_graph,         # MEMORY.md Zepå›¾è°±
        pinecone_store,    # MEMORY.md Pineconeå­˜å‚¨
        emotion_engine     # EMOTION.md æƒ…ç»ªå¼•æ“
    ):
        self.mem0 = mem0_manager
        self.zep = zep_graph
        self.pinecone = pinecone_store
        self.emotion = emotion_engine
        
        # æ¡¥æ¥ç»„ä»¶
        self.emotion_to_memory = EmotionToMemoryBridge(mem0_manager, emotion_engine)
        self.memory_to_emotion = MemoryToEmotionBridge(emotion_engine)
    
    async def store_emotion_memory(
        self,
        emotion_state: Dict,
        context: str,
        associated_memories: List[str] = None
    ) -> str:
        """
        å­˜å‚¨æƒ…ç»ªè®°å¿†åˆ°MEMORY.mdç³»ç»Ÿ
        
        Args:
            emotion_state: æƒ…ç»ªçŠ¶æ€
            context: ä¸Šä¸‹æ–‡
            associated_memories: å…³è”çš„è®°å¿†ID
            
        Returns:
            æƒ…ç»ªè®°å¿†ID
        """
        # æ„å»ºæƒ…ç»ªè®°å¿†å†…å®¹
        emotion_content = self._format_emotion_memory(emotion_state, context)
        
        # å­˜å‚¨åˆ°Mem0
        memory_id = await self.mem0.add_memory(
            content=emotion_content,
            memory_type="episodic",
            importance=emotion_state.get("intensity", 0.5) * 0.8,
            metadata={
                "emotion_type": "emotion_state",
                "base_emotion": emotion_state.get("emotion"),
                "sub_emotion": emotion_state.get("sub_emotion"),
                "intensity": emotion_state.get("intensity"),
                "valence": emotion_state.get("valence"),
                "arousal": emotion_state.get("arousal"),
                "context": context,
                "associated_memories": associated_memories or []
            }
        )
        
        # æ·»åŠ åˆ°EPGå›¾è°±
        await self._add_to_emotion_graph(memory_id, emotion_state, context)
        
        return memory_id
    
    async def retrieve_contextual_memories(
        self,
        query: str,
        current_emotion: str,
        limit: int = 10
    ) -> List[Dict]:
        """
        æƒ…ç»ªæ„ŸçŸ¥çš„è®°å¿†æ£€ç´¢
        
        ç»“åˆå½“å‰æƒ…ç»ªçŠ¶æ€ï¼Œæ£€ç´¢æœ€ç›¸å…³çš„è®°å¿†
        """
        # 1. åŸºäºæƒ…ç»ªè°ƒæ•´æ£€ç´¢æƒé‡
        emotion_weights = self._get_emotion_retrieval_weights(current_emotion)
        
        # 2. æ‰§è¡Œèåˆæ£€ç´¢
        vector_results = await self._emotion_aware_vector_search(
            query, emotion_weights, limit
        )
        
        # 3. è·å–æƒ…ç»ªç›¸å…³è®°å¿†
        emotion_memories = await self.emotion_to_memory.retrieve_memories_by_emotion(
            emotion=current_emotion,
            sub_emotion=None,
            intensity=0.7,
            context=query,
            limit=limit // 2
        )
        
        # 4. åˆå¹¶å¹¶å»é‡
        merged = self._merge_memory_results(vector_results, emotion_memories)
        
        return merged[:limit]
    
    async def update_memory_with_emotion(
        self,
        memory_id: str,
        emotion_state: Dict
    ):
        """
        æ›´æ–°è®°å¿†çš„æƒ…ç»ªæ ‡ç­¾
        
        å½“è®°å¿†è¢«æ£€ç´¢æ—¶ï¼Œè®°å½•å½“æ—¶çš„æƒ…ç»ªçŠ¶æ€
        """
        # è·å–ç°æœ‰è®°å¿†
        memory = await self.mem0.get_memory(memory_id)
        if not memory:
            return
        
        # æ›´æ–°æƒ…ç»ªå…³è”
        associated_emotions = memory.metadata.get("associated_emotions", [])
        emotion_tag = emotion_state.get("emotion")
        
        if emotion_tag not in associated_emotions:
            associated_emotions.append(emotion_tag)
        
        # æ›´æ–°è®¿é—®æ—¶çš„æƒ…ç»ª
        await self.mem0.update_memory(
            memory_id=memory_id,
            metadata={
                "associated_emotions": associated_emotions,
                "last_access_emotion": emotion_tag,
                "last_access_intensity": emotion_state.get("intensity")
            }
        )
    
    def _format_emotion_memory(
        self,
        emotion_state: Dict,
        context: str
    ) -> str:
        """æ ¼å¼åŒ–æƒ…ç»ªè®°å¿†å†…å®¹"""
        emotion = emotion_state.get("emotion", "Unknown")
        sub_emotion = emotion_state.get("sub_emotion", "")
        intensity = emotion_state.get("intensity", 0.5)
        
        parts = [f"æƒ…ç»ªçŠ¶æ€: {emotion}"]
        if sub_emotion:
            parts.append(f"({sub_emotion})")
        parts.append(f"å¼ºåº¦: {intensity:.2f}")
        parts.append(f"æƒ…å¢ƒ: {context}")
        
        return " | ".join(parts)
    
    def _get_emotion_retrieval_weights(self, emotion: str) -> Dict:
        """è·å–æƒ…ç»ªç‰¹å®šçš„æ£€ç´¢æƒé‡"""
        weights = {
            "Excited": {"recency": 0.4, "importance": 0.3, "emotion_match": 0.3},
            "Focused": {"recency": 0.2, "importance": 0.5, "emotion_match": 0.3},
            "Concerned": {"recency": 0.3, "importance": 0.4, "emotion_match": 0.3},
            "Reflective": {"recency": 0.2, "importance": 0.3, "emotion_match": 0.5},
            "default": {"recency": 0.3, "importance": 0.4, "emotion_match": 0.3}
        }
        return weights.get(emotion, weights["default"])
```

---

## ğŸ§ª å…¨é¢æµ‹è¯•éªŒè¯

### æµ‹è¯•å¥—ä»¶

```python
# tests/test_emotion_system.py

import pytest
from datetime import datetime, timedelta

class TestEmotionSystem:
    """æƒ…ç»ªç³»ç»Ÿæµ‹è¯•å¥—ä»¶"""
    
    @pytest.fixture
    def emotion_engine(self):
        from emotion_system.engine import EmotionEngine
        return EmotionEngine()
    
    # ========== åŸºç¡€æƒ…ç»ªæµ‹è¯• ==========
    
    def test_16_base_emotions_defined(self):
        """æµ‹è¯•16ç§åŸºç¡€æƒ…ç»ªå·²å®šä¹‰"""
        from emotion_system.emotions import BASE_EMOTIONS
        assert len(BASE_EMOTIONS) == 16
        
        required_emotions = [
            "Excited", "Confident", "Focused", "Concerned",
            "Reflective", "Content", "Curious", "Patient",
            "Urgent", "Calm", "Confused", "Frustrated",
            "Grateful", "Alert", "Playful", "Serious"
        ]
        for emotion in required_emotions:
            assert emotion in BASE_EMOTIONS
    
    def test_64_sub_emotions_defined(self):
        """æµ‹è¯•64ç§ç²¾ç»†æƒ…ç»ªå­ç±»å‹å·²å®šä¹‰"""
        from emotion_system.emotions import SUB_EMOTIONS
        assert len(SUB_EMOTIONS) == 64
        
        # æ¯ç§åŸºç¡€æƒ…ç»ªæœ‰4ä¸ªå­ç±»å‹
        for base in BASE_EMOTIONS:
            sub_count = len([s for s in SUB_EMOTIONS if s.startswith(base)])
            assert sub_count == 4, f"{base} should have 4 sub-emotions"
    
    # ========== è§¦å‘å™¨æµ‹è¯• ==========
    
    def test_keyword_triggers(self, emotion_engine):
        """æµ‹è¯•å…³é”®è¯è§¦å‘å™¨"""
        # æµ‹è¯•å…´å¥‹è§¦å‘
        result = emotion_engine.process_input("é‡å¤§çªç ´ï¼æˆ‘ä»¬æˆåŠŸäº†ï¼")
        assert result["emotion"] == "Excited"
        assert result["intensity"] > 0.7
        
        # æµ‹è¯•æ‹…å¿§è§¦å‘
        result = emotion_engine.process_input("æˆ‘åˆç†¬å¤œäº†ï¼Œæ²¡ç¡è§‰")
        assert result["emotion"] == "Concerned"
        assert result["priority"] == 10
        
        # æµ‹è¯•ç´§è¿«è§¦å‘
        result = emotion_engine.process_input("ç´§æ€¥ï¼deadlineè¿˜æœ‰1å°æ—¶")
        assert result["emotion"] == "Urgent"
    
    def test_pattern_triggers(self, emotion_engine):
        """æµ‹è¯•æ¨¡å¼è§¦å‘å™¨"""
        result = emotion_engine.process_input("ä»»åŠ¡å·²ç»å®Œæˆï¼Œé¡¹ç›®ç»“æŸäº†")
        assert result["emotion"] == "Content"
        
        result = emotion_engine.process_input("å‘ç°äº†ä¸€ä¸ªä¸¥é‡çš„bug")
        assert result["emotion"] == "Alert"
    
    # ========== è¡°å‡æœºåˆ¶æµ‹è¯• ==========
    
    def test_emotion_decay(self, emotion_engine):
        """æµ‹è¯•æƒ…ç»ªè¡°å‡"""
        # è®¾ç½®åˆå§‹å…´å¥‹çŠ¶æ€
        emotion_engine.set_emotion("Excited", 0.9)
        
        # æ¨¡æ‹Ÿ10åˆ†é’Ÿè¿‡å»
        new_intensity = emotion_engine.calculate_decay(
            "Excited", 0.9, elapsed_minutes=10
        )
        
        # å…´å¥‹åº”è¯¥æ˜¾è‘—è¡°å‡
        assert new_intensity < 0.9
        assert new_intensity > 0  # ä½†ä¸åº”å®Œå…¨æ¶ˆå¤±
    
    def test_decay_transition(self, emotion_engine):
        """æµ‹è¯•è¡°å‡å¯¼è‡´çš„æƒ…ç»ªè½¬æ¢"""
        emotion_engine.set_emotion("Excited", 0.3, duration_minutes=20)
        
        result = emotion_engine.check_transition()
        assert result["should_transition"] == True
        assert result["target_emotion"] == "Content"
    
    # ========== å¼ºåŒ–æœºåˆ¶æµ‹è¯• ==========
    
    def test_emotion_reinforcement(self, emotion_engine):
        """æµ‹è¯•æƒ…ç»ªå¼ºåŒ–"""
        emotion_engine.set_emotion("Excited", 0.7)
        
        # è§¦å‘å¼ºåŒ–
        result = emotion_engine.apply_reinforcement(
            "Excited", trigger="è¿›ä¸€æ­¥çªç ´"
        )
        
        assert result["new_intensity"] > 0.7
        assert result["duration_extension"] > 0
    
    def test_consecutive_reinforcement(self, emotion_engine):
        """æµ‹è¯•è¿ç»­è§¦å‘å¼ºåŒ–"""
        emotion_engine.set_emotion("Excited", 0.6)
        
        # è¿ç»­3æ¬¡å¼ºåŒ–
        for i in range(3):
            result = emotion_engine.apply_reinforcement(
                "Excited", trigger="æˆåŠŸ", consecutive_count=i+1
            )
        
        # ç¬¬3æ¬¡åº”è¯¥æœ‰åŠ æˆ
        assert result["boost"] > 0.15  # åŸºç¡€boostæ˜¯0.15
    
    # ========== EPGå›¾è°±æµ‹è¯• ==========
    
    def test_emotion_node_creation(self):
        """æµ‹è¯•æƒ…ç»ªèŠ‚ç‚¹åˆ›å»º"""
        from emotion_system.epg import EmotionGraph
        
        graph = EmotionGraph()
        node_id = graph.add_emotion_node(
            base_emotion="Excited",
            sub_emotion="Ecstatic",
            intensity=0.95,
            context="é‡å¤§çªç ´"
        )
        
        assert node_id is not None
        node = graph.get_node(node_id)
        assert node["base_emotion"] == "Excited"
        assert node["intensity"] == 0.95
    
    def test_emotion_memory_association(self):
        """æµ‹è¯•æƒ…ç»ª-è®°å¿†å…³è”"""
        from emotion_system.epg import EmotionGraph
        
        graph = EmotionGraph()
        
        # åˆ›å»ºæƒ…ç»ªèŠ‚ç‚¹
        emotion_id = graph.add_emotion_node(
            base_emotion="Excited",
            intensity=0.8
        )
        
        # åˆ›å»ºè®°å¿†èŠ‚ç‚¹
        memory_id = graph.add_memory_node(
            memory_ref="mem_123",
            content="é‡å¤§çªç ´è®°å¿†"
        )
        
        # å»ºç«‹å…³è”
        assoc_id = graph.add_emotion_memory_association(
            emotion_id, memory_id, strength=0.9
        )
        
        assert assoc_id is not None
        
        # éªŒè¯åŒå‘å…³è”
        related_memories = graph.get_related_memories(emotion_id)
        assert len(related_memories) == 1
        assert related_memories[0]["memory_id"] == memory_id
    
    # ========== è®°å¿†é›†æˆæµ‹è¯• ==========
    
    @pytest.mark.asyncio
    async def test_emotion_memory_storage(self):
        """æµ‹è¯•æƒ…ç»ªè®°å¿†å­˜å‚¨åˆ°MEMORY.md"""
        from emotion_system.memory_integration import EmotionMemoryIntegration
        
        integration = EmotionMemoryIntegration(
            mem0_manager=mock_mem0(),
            zep_graph=mock_zep(),
            pinecone_store=mock_pinecone(),
            emotion_engine=mock_emotion_engine()
        )
        
        emotion_state = {
            "emotion": "Excited",
            "sub_emotion": "Ecstatic",
            "intensity": 0.95,
            "valence": 0.9,
            "arousal": 0.95
        }
        
        memory_id = await integration.store_emotion_memory(
            emotion_state=emotion_state,
            context="å®Œæˆé‡å¤§çªç ´"
        )
        
        assert memory_id is not None
    
    @pytest.mark.asyncio
    async def test_emotion_aware_retrieval(self):
        """æµ‹è¯•æƒ…ç»ªæ„ŸçŸ¥è®°å¿†æ£€ç´¢"""
        from emotion_system.memory_integration import EmotionMemoryIntegration
        
        integration = EmotionMemoryIntegration(
            mem0_manager=mock_mem0(),
            zep_graph=mock_zep(),
            pinecone_store=mock_pinecone(),
            emotion_engine=mock_emotion_engine()
        )
        
        # åœ¨å…´å¥‹çŠ¶æ€ä¸‹æ£€ç´¢
        memories = await integration.retrieve_contextual_memories(
            query="çªç ´",
            current_emotion="Excited",
            limit=5
        )
        
        # åº”è¯¥ä¼˜å…ˆè¿”å›æˆåŠŸ/çªç ´ç±»å‹çš„è®°å¿†
        assert len(memories) > 0
        assert all("success" in m.get("tags", []) or "breakthrough" in m.get("tags", []) 
                   for m in memories)
    
    # ========== åŒå‘å…³è”æµ‹è¯• ==========
    
    @pytest.mark.asyncio
    async def test_emotion_to_memory_bridge(self):
        """æµ‹è¯•æƒ…ç»ªâ†’è®°å¿†æ¡¥æ¥"""
        from emotion_system.emotion_memory_bridge import EmotionToMemoryBridge
        
        bridge = EmotionToMemoryBridge(
            memory_manager=mock_mem0(),
            emotion_graph=mock_graph()
        )
        
        memories = await bridge.retrieve_memories_by_emotion(
            emotion="Concerned",
            sub_emotion="Caring",
            intensity=0.7,
            context="ç”¨æˆ·å¥åº·",
            limit=5
        )
        
        # åº”è¯¥è¿”å›å…³æ€€ç›¸å…³çš„è®°å¿†
        assert all("care" in m.get("memory_type", "") for m in memories)
    
    @pytest.mark.asyncio
    async def test_memory_to_emotion_bridge(self):
        """æµ‹è¯•è®°å¿†â†’æƒ…ç»ªæ¡¥æ¥"""
        from emotion_system.emotion_memory_bridge import MemoryToEmotionBridge
        
        bridge = MemoryToEmotionBridge(
            emotion_engine=mock_emotion_engine()
        )
        
        # æ¨¡æ‹Ÿæ£€ç´¢åˆ°æˆåŠŸè®°å¿†
        retrieved_memories = [
            {"memory_type": "success", "created_at": datetime.now() - timedelta(days=1)},
            {"memory_type": "success", "created_at": datetime.now() - timedelta(days=2)}
        ]
        
        result = await bridge.apply_memory_emotion_influence(
            retrieved_memories=retrieved_memories,
            current_emotion="Calm",
            current_intensity=0.5
        )
        
        # æˆåŠŸè®°å¿†åº”è¯¥å¢å¼ºè‡ªä¿¡
        assert result["emotion"] == "Confident"
        assert result["intensity"] > 0.5
    
    # ========== é›†æˆæµ‹è¯• ==========
    
    @pytest.mark.asyncio
    async def test_full_emotion_workflow(self):
        """æµ‹è¯•å®Œæ•´æƒ…ç»ªå·¥ä½œæµç¨‹"""
        from emotion_system.engine import EmotionEngine
        from emotion_system.memory_integration import EmotionMemoryIntegration
        
        # åˆå§‹åŒ–ç³»ç»Ÿ
        engine = EmotionEngine()
        integration = EmotionMemoryIntegration(
            mem0_manager=mock_mem0(),
            zep_graph=mock_zep(),
            pinecone_store=mock_pinecone(),
            emotion_engine=engine
        )
        
        # 1. å¤„ç†ç”¨æˆ·è¾“å…¥ï¼Œæ£€æµ‹æƒ…ç»ª
        result = engine.process_input("é‡å¤§çªç ´ï¼æˆ‘ä»¬æˆåŠŸäº†ï¼")
        assert result["emotion"] == "Excited"
        
        # 2. å­˜å‚¨æƒ…ç»ªè®°å¿†
        memory_id = await integration.store_emotion_memory(
            emotion_state=result,
            context="ç”¨æˆ·å®£å¸ƒé‡å¤§çªç ´"
        )
        
        # 3. æƒ…ç»ªè§¦å‘ç›¸å…³è®°å¿†æ£€ç´¢
        related_memories = await integration.retrieve_contextual_memories(
            query="çªç ´",
            current_emotion=result["emotion"]
        )
        
        # 4. æ¨¡æ‹Ÿæ—¶é—´è¿‡å»ï¼Œæƒ…ç»ªè¡°å‡
        new_intensity = engine.calculate_decay(
            result["emotion"], result["intensity"], elapsed_minutes=15
        )
        
        assert new_intensity < result["intensity"]
        
        # 5. æ£€æŸ¥æƒ…ç»ªè½¬æ¢
        transition = engine.check_transition()
        if new_intensity < 0.3:
            assert transition["should_transition"] == True
```

### æ€§èƒ½æµ‹è¯•

```python
# tests/test_emotion_performance.py

import time
import pytest

class TestEmotionPerformance:
    """æƒ…ç»ªç³»ç»Ÿæ€§èƒ½æµ‹è¯•"""
    
    def test_trigger_detection_latency(self):
        """æµ‹è¯•è§¦å‘å™¨æ£€æµ‹å»¶è¿Ÿ"""
        from emotion_system.engine import EmotionEngine
        
        engine = EmotionEngine()
        
        start = time.time()
        for _ in range(100):
            engine.process_input("é‡å¤§çªç ´ï¼æˆ‘ä»¬æˆåŠŸäº†ï¼")
        elapsed = time.time() - start
        
        # 100æ¬¡æ£€æµ‹åº”åœ¨100mså†…å®Œæˆ
        assert elapsed < 0.1, f"Trigger detection too slow: {elapsed}s"
    
    def test_decay_calculation_performance(self):
        """æµ‹è¯•è¡°å‡è®¡ç®—æ€§èƒ½"""
        from emotion_system.decay import EmotionDecayModel
        
        model = EmotionDecayModel()
        
        start = time.time()
        for _ in range(1000):
            model.calculate_decay("Excited", 0.8, elapsed_minutes=10)
        elapsed = time.time() - start
        
        # 1000æ¬¡è®¡ç®—åº”åœ¨50mså†…å®Œæˆ
        assert elapsed < 0.05, f"Decay calculation too slow: {elapsed}s"
    
    @pytest.mark.asyncio
    async def test_memory_retrieval_latency(self):
        """æµ‹è¯•æƒ…ç»ªæ„ŸçŸ¥è®°å¿†æ£€ç´¢å»¶è¿Ÿ"""
        from emotion_system.memory_integration import EmotionMemoryIntegration
        
        integration = EmotionMemoryIntegration(
            mem0_manager=mock_mem0(),
            zep_graph=mock_zep(),
            pinecone_store=mock_pinecone(),
            emotion_engine=mock_emotion_engine()
        )
        
        start = time.time()
        memories = await integration.retrieve_contextual_memories(
            query="çªç ´",
            current_emotion="Excited",
            limit=10
        )
        elapsed = time.time() - start
        
        # æ£€ç´¢åº”åœ¨200mså†…å®Œæˆ
        assert elapsed < 0.2, f"Memory retrieval too slow: {elapsed}s"
        assert len(memories) <= 10
```

---

## ğŸ“Š ç³»ç»Ÿé…ç½®

### å®Œæ•´é…ç½®ç¤ºä¾‹

```yaml
# emotion_config.yaml
emotion_system:
  version: "4.0"
  
  # æƒ…ç»ªæ¨¡å‹é…ç½®
  emotion_model:
    base_emotions: 16
    sub_emotions: 64
    default_emotion: "Calm"
    default_intensity: 0.5
    
  # è§¦å‘å™¨é…ç½®
  triggers:
    keyword:
      enabled: true
      case_sensitive: false
      priority_boost: 2
    pattern:
      enabled: true
      regex_timeout: 100ms
    context:
      enabled: true
      context_window: 5
    memory:
      enabled: true
      similarity_threshold: 0.85
      
  # è¡°å‡é…ç½®
  decay:
    check_interval: 60s  # æ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
    min_intensity: 0.1   # ä½äºæ­¤å€¼æƒ…ç»ªæ¶ˆé€€
    context_modifiers:
      deep_work: 0.5
      crisis: 0.3
      relaxation: 0.8
      
  # å¼ºåŒ–é…ç½®
  reinforcement:
    consecutive_threshold: 3
    consecutive_multiplier: 1.3
    max_intensity: 1.0
    
  # EPGå›¾è°±é…ç½®
  epg:
    graph_db: "neo4j"  # æˆ– "zep"
    node_capacity: 100000
    relation_capacity: 500000
    
  # è®°å¿†é›†æˆé…ç½®
  memory_integration:
    enabled: true
    emotion_tagging: true
    bidirectional_association: true
    retrieval_weights:
      vector: 0.4
      temporal: 0.3
      graph: 0.3
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### åˆå§‹åŒ–æƒ…ç»ªç³»ç»Ÿ

```python
# åˆå§‹åŒ–é…ç½®
config = {
    "emotion_model": {
        "base_emotions": 16,
        "sub_emotions": 64
    },
    "triggers": {
        "keyword": {"enabled": True},
        "pattern": {"enabled": True}
    },
    "memory_integration": {
        "enabled": True
    }
}

# åˆ›å»ºæƒ…ç»ªå¼•æ“
from emotion_system.engine import EmotionEngine
emotion_engine = EmotionEngine(config)

# å¤„ç†è¾“å…¥ï¼Œæ£€æµ‹æƒ…ç»ª
result = emotion_engine.process_input("é‡å¤§çªç ´ï¼æˆ‘ä»¬æˆåŠŸäº†ï¼")
print(f"Detected emotion: {result['emotion']}, intensity: {result['intensity']}")

# è·å–å½“å‰æƒ…ç»ªçŠ¶æ€
current = emotion_engine.get_current_emotion()
print(f"Current: {current['emotion']} ({current['sub_emotion']}) at {current['intensity']}")

# æ‰‹åŠ¨è®¾ç½®æƒ…ç»ª
emotion_engine.set_emotion("Focused", intensity=0.8, sub_emotion="Immersed")

# æ¨¡æ‹Ÿæ—¶é—´è¡°å‡
new_intensity = emotion_engine.calculate_decay("Excited", 0.9, elapsed_minutes=10)
```

### ä¸MEMORY.mdé›†æˆä½¿ç”¨

```python
# åˆå§‹åŒ–é›†æˆ
from emotion_system.memory_integration import EmotionMemoryIntegration

integration = EmotionMemoryIntegration(
    mem0_manager=memory_manager,  # æ¥è‡ªMEMORY.md
    zep_graph=zep_graph,
    pinecone_store=pinecone_store,
    emotion_engine=emotion_engine
)

# å­˜å‚¨æƒ…ç»ªè®°å¿†
memory_id = await integration.store_emotion_memory(
    emotion_state={"emotion": "Excited", "intensity": 0.9},
    context="å®Œæˆé‡å¤§çªç ´",
    associated_memories=["mem_001", "mem_002"]
)

# æƒ…ç»ªæ„ŸçŸ¥æ£€ç´¢
memories = await integration.retrieve_contextual_memories(
    query="çªç ´",
    current_emotion="Excited",
    limit=5
)
```

---

## ğŸ“ˆ ç³»ç»ŸçŠ¶æ€ç›‘æ§

### æƒ…ç»ªç³»ç»Ÿå¥åº·åº¦æŠ¥å‘Š

```json
{
  "timestamp": "2026-02-27T19:34:00Z",
  "system_version": "4.0.0",
  "current_emotion": {
    "base": "Focused",
    "sub": "Concentrated",
    "intensity": 0.75,
    "duration_minutes": 15
  },
  "emotion_history": [
    {"emotion": "Excited", "intensity": 0.9, "timestamp": "2026-02-27T19:20:00Z"},
    {"emotion": "Content", "intensity": 0.6, "timestamp": "2026-02-27T19:25:00Z"},
    {"emotion": "Focused", "intensity": 0.75, "timestamp": "2026-02-27T19:30:00Z"}
  ],
  "trigger_stats": {
    "keyword_triggers": 45,
    "pattern_triggers": 23,
    "context_triggers": 12,
    "memory_triggers": 8
  },
  "epg_stats": {
    "emotion_nodes": 1250,
    "memory_nodes": 3400,
    "associations": 5200
  },
  "integration_status": {
    "memory_connected": true,
    "graph_synced": true,
    "last_sync": "2026-02-27T19:33:00Z"
  },
  "health_score": 0.94
}
```

---

**æ–‡æ¡£ç»“æŸ**

> EMOTION.md v4.0 å®ç°äº†å®Œæ•´çš„EPGæƒ…ç»ªè®°å¿†å›¾è°±ç³»ç»Ÿï¼ŒåŒ…å«16ç§SimsChatåŸºç¡€æƒ…ç»ªæ‰©å±•ä¸º64ç§ç²¾ç»†å­ç±»å‹ã€æƒ…ç»ªè§¦å‘å™¨ç³»ç»Ÿã€è¡°å‡/å¼ºåŒ–æœºåˆ¶ã€æƒ…ç»ª-è®°å¿†åŒå‘å…³è”ï¼Œä»¥åŠä¸MEMORY.md v3.0çš„æ·±åº¦é›†æˆã€‚ç³»ç»Ÿå·²ç”Ÿäº§å°±ç»ªï¼Œå¯ç«‹å³éƒ¨ç½²ä½¿ç”¨ã€‚
