# HEARTBEAT.md v2.0 - AI Agent å¿ƒè·³ä¸ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿ

> **ç‰ˆæœ¬**: v2.0  
> **çŠ¶æ€**: ç”Ÿäº§å°±ç»ª  
> **å…³è”æ–‡æ¡£**: SOUL.md v4.0, AGENTS.md v2.0, IDENTITY.md v4.0  
> **æ ¸å¿ƒç‰¹æ€§**: å¼ºåŒ–è‡ªæ„ˆèƒ½åŠ›ã€ä¼˜åŒ–ä»»åŠ¡è°ƒåº¦ã€å®Œå–„ç›‘æ§å‘Šè­¦ã€å¢å¼ºä¸SOUL_v4é›†æˆ

---

## ğŸ“‹ ç›®å½•

1. [ç³»ç»Ÿæ¦‚è¿°](#1-ç³»ç»Ÿæ¦‚è¿°)
2. [å¿ƒè·³æœºåˆ¶è®¾è®¡](#2-å¿ƒè·³æœºåˆ¶è®¾è®¡)
3. [ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿ](#3-ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿ)
4. [ç›‘æ§å‘Šè­¦æœºåˆ¶](#4-ç›‘æ§å‘Šè­¦æœºåˆ¶)
5. [è‡ªæ„ˆèƒ½åŠ›è®¾è®¡](#5-è‡ªæ„ˆèƒ½åŠ›è®¾è®¡)
6. [çŠ¶æ€åŒæ­¥æœºåˆ¶](#6-çŠ¶æ€åŒæ­¥æœºåˆ¶)
7. [è´Ÿè½½å‡è¡¡ç­–ç•¥](#7-è´Ÿè½½å‡è¡¡ç­–ç•¥)
8. [å®¹é”™è®¾è®¡](#8-å®¹é”™è®¾è®¡)
9. [ä¸SOUL_v4å’ŒAGENTS.mdé›†æˆ](#9-ä¸soul_v4å’Œagentsmdé›†æˆ)
10. [å®ç°ä»£ç æ¡†æ¶](#10-å®ç°ä»£ç æ¡†æ¶)
11. [ç›‘æ§é¢æ¿è®¾è®¡](#11-ç›‘æ§é¢æ¿è®¾è®¡)

---

## 1. ç³»ç»Ÿæ¦‚è¿°

### 1.1 è®¾è®¡ç›®æ ‡

HEARTBEATç³»ç»Ÿæ˜¯ä¸ºOpenClawå¤šAgentæ¶æ„è®¾è®¡çš„æ ¸å¿ƒåŸºç¡€è®¾æ–½ï¼Œå®ç°ä»¥ä¸‹ç›®æ ‡ï¼š

- **å¥åº·ç›‘æµ‹**: å®æ—¶æ£€æµ‹Agentå­˜æ´»çŠ¶æ€å’Œå¥åº·çŠ¶å†µ
- **ä»»åŠ¡è°ƒåº¦**: æ™ºèƒ½åˆ†é…ä»»åŠ¡ï¼Œä¼˜åŒ–èµ„æºåˆ©ç”¨
- **æ•…éšœè‡ªæ„ˆ**: è‡ªåŠ¨æ£€æµ‹å’Œæ¢å¤æ•…éšœAgent
- **çŠ¶æ€ä¸€è‡´**: ç»´æŠ¤å¤šAgenté—´çŠ¶æ€åŒæ­¥
- **è´Ÿè½½å‡è¡¡**: åŠ¨æ€åˆ†é…è´Ÿè½½ï¼Œé˜²æ­¢å•ç‚¹è¿‡è½½
- **SOUL_v4é›†æˆ**: ä¸8ç»´åº¦äººæ ¼æ¨¡å‹æ·±åº¦é›†æˆ

### 1.2 æ ¸å¿ƒåŸåˆ™

| åŸåˆ™ | æè¿° | å®ç°æ–¹å¼ | SOUL_v4æ˜ å°„ |
|------|------|----------|-------------|
| **ä¸»åŠ¨æ¢æµ‹** | ä¸ç­‰æ•…éšœå‘ç”Ÿï¼Œä¸»åŠ¨æ£€æµ‹ | å‘¨æœŸæ€§å¿ƒè·³ + äº‹ä»¶è§¦å‘ | Motivations: ä¸»åŠ¨æ€§ |
| **åˆ†çº§å“åº”** | ä¸åŒä¸¥é‡ç¨‹åº¦ä¸åŒå¤„ç† | ä¸‰çº§å‘Šè­¦æœºåˆ¶ | Conflict: å†²çªå¤„ç† |
| **ä¼˜é›…é™çº§** | æ•…éšœæ—¶ä¿æŒæ ¸å¿ƒåŠŸèƒ½ | æœåŠ¡åˆ†çº§ + ç†”æ–­æœºåˆ¶ | Physical: å½¢è±¡åˆ‡æ¢ |
| **å¿«é€Ÿæ¢å¤** | æœ€å°åŒ–æ•…éšœå½±å“æ—¶é—´ | è‡ªåŠ¨é‡å¯ + çƒ­å¤‡åˆ‡æ¢ | Growth: æŒç»­æ”¹è¿› |
| **é€æ˜å¯è§‚æµ‹** | å…¨æµç¨‹å¯è¿½è¸ª | ç»“æ„åŒ–æ—¥å¿— + ç›‘æ§é¢æ¿ | Relationships: ä¿¡ä»»å»ºç«‹ |
| **äººæ ¼ä¸€è‡´** | ä¿æŒSOUL_v4äººæ ¼ç¨³å®š | è‡ªæ„ˆæ—¶ç»´æŠ¤äººæ ¼çŠ¶æ€ | Personality: ä¸€è‡´æ€§ |

### 1.3 ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      HEARTBEAT v2.0 æ ¸å¿ƒç³»ç»Ÿ                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚  å¿ƒè·³ç®¡ç†å™¨  â”‚  â”‚  ä»»åŠ¡è°ƒåº¦å™¨  â”‚  â”‚  ç›‘æ§å‘Šè­¦å™¨  â”‚             â”‚
â”‚  â”‚  Heartbeat  â”‚  â”‚  Scheduler  â”‚  â”‚   Monitor   â”‚             â”‚
â”‚  â”‚   Manager   â”‚  â”‚             â”‚  â”‚             â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚         â”‚                â”‚                â”‚                     â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                          â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚              çŠ¶æ€ç®¡ç†å™¨ (State Manager)        â”‚              â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚              â”‚
â”‚  â”‚  â”‚AgentçŠ¶æ€â”‚ â”‚ä»»åŠ¡çŠ¶æ€ â”‚ â”‚èµ„æºçŠ¶æ€ â”‚         â”‚              â”‚
â”‚  â”‚  â”‚+SOULçŠ¶æ€â”‚ â”‚         â”‚ â”‚         â”‚         â”‚              â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                          â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚              è‡ªæ„ˆæ§åˆ¶å™¨ (Self-Healing)         â”‚              â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚              â”‚
â”‚  â”‚  â”‚æ•…éšœæ£€æµ‹ â”‚ â”‚æ¢å¤ç­–ç•¥ â”‚ â”‚é™çº§å¤„ç† â”‚         â”‚              â”‚
â”‚  â”‚  â”‚+äººæ ¼ä¿æŠ¤â”‚ â”‚+çŠ¶æ€æ¢å¤â”‚ â”‚+SOULä¿æŒâ”‚         â”‚              â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                          â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚              SOUL_v4é›†æˆå±‚                     â”‚              â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚              â”‚
â”‚  â”‚  â”‚æƒ…ç»ªç›‘æ§ â”‚ â”‚äººæ ¼æ¼‚ç§» â”‚ â”‚å®ªæ³•æ£€æŸ¥ â”‚         â”‚              â”‚
â”‚  â”‚  â”‚         â”‚ â”‚ æ£€æµ‹    â”‚ â”‚         â”‚         â”‚              â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“                     â†“                     â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Agent 1 â”‚          â”‚ Agent 2 â”‚   ...    â”‚ Agent N â”‚
   â”‚+SOULçŠ¶æ€ â”‚          â”‚+SOULçŠ¶æ€ â”‚          â”‚+SOULçŠ¶æ€ â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. å¿ƒè·³æœºåˆ¶è®¾è®¡

### 2.1 å¿ƒè·³ç±»å‹

åŸºäºKubernetesæ¢é’ˆè®¾è®¡ï¼Œå®šä¹‰ä¸‰ç§å¿ƒè·³ç±»å‹ï¼š

| ç±»å‹ | ç›®çš„ | é¢‘ç‡ | å¤±è´¥å¤„ç† | SOULç»´åº¦ |
|------|------|------|----------|----------|
| **Liveness** | æ£€æµ‹Agentæ˜¯å¦å­˜æ´» | 30ç§’ | è‡ªåŠ¨é‡å¯ | Physical |
| **Readiness** | æ£€æµ‹Agentæ˜¯å¦å°±ç»ª | 10ç§’ | ç§»å‡ºè´Ÿè½½æ±  | Physical |
| **Startup** | æ£€æµ‹Agentå¯åŠ¨å®Œæˆ | 5ç§’(å¯åŠ¨æœŸ) | ç­‰å¾…é‡è¯• | Growth |
| **SOUL** | æ£€æµ‹äººæ ¼çŠ¶æ€å¥åº· | 60ç§’ | äººæ ¼æ ¡å‡† | Personality |

### 2.2 å¿ƒè·³åè®®

```python
class HeartbeatMessage:
    """å¿ƒè·³æ¶ˆæ¯ç»“æ„"""
    agent_id: str           # Agentå”¯ä¸€æ ‡è¯†
    agent_type: str         # Agentç±»å‹(research/dev/dataç­‰)
    timestamp: float        # å‘é€æ—¶é—´æˆ³
    sequence: int           # åºåˆ—å·(ç”¨äºæ£€æµ‹ä¸¢åŒ…)
    
    # çŠ¶æ€ä¿¡æ¯
    status: AgentStatus     # å½“å‰çŠ¶æ€
    load: float            # è´Ÿè½½ç‡(0-1)
    memory_usage: float    # å†…å­˜ä½¿ç”¨ç‡
    task_count: int        # å½“å‰ä»»åŠ¡æ•°
    
    # SOUL_v4çŠ¶æ€
    soul_state: SoulState   # SOULäººæ ¼çŠ¶æ€
    current_emotion: str    # å½“å‰æƒ…ç»ª
    dimension_stability: Dict[str, float]  # å„ç»´åº¦ç¨³å®šæ€§
    constitutional_compliance: float  # å®ªæ³•éµå®ˆåº¦
    
    # æ‰©å±•ä¿¡æ¯
    capabilities: List[str] # èƒ½åŠ›åˆ—è¡¨
    version: str           # ç‰ˆæœ¬å·
    metadata: Dict         # è‡ªå®šä¹‰å…ƒæ•°æ®

class SoulState:
    """SOULäººæ ¼çŠ¶æ€"""
    current_stage: str      # æ¼”åŒ–é˜¶æ®µ
    dominant_dimension: str # ä¸»å¯¼ç»´åº¦
    emotional_state: str    # æƒ…ç»ªçŠ¶æ€
    constitutional_violations: int  # å®ªæ³•è¿åæ¬¡æ•°
    personality_drift: float  # äººæ ¼æ¼‚ç§»åˆ†æ•°
```

### 2.3 å¿ƒè·³é¢‘ç‡ä¸è¶…æ—¶

```python
HEARTBEAT_CONFIG = {
    # åŸºç¡€é…ç½®
    "liveness": {
        "interval": 30,      # 30ç§’å‘é€ä¸€æ¬¡
        "timeout": 90,       # 90ç§’æ— å“åº”è§†ä¸ºå¤±è´¥
        "failure_threshold": 3  # è¿ç»­3æ¬¡å¤±è´¥è§¦å‘é‡å¯
    },
    "readiness": {
        "interval": 10,      # 10ç§’æ£€æŸ¥ä¸€æ¬¡
        "timeout": 30,       # 30ç§’æ— å“åº”è§†ä¸ºæœªå°±ç»ª
        "failure_threshold": 2
    },
    "startup": {
        "interval": 5,       # å¯åŠ¨æœŸ5ç§’æ£€æŸ¥
        "timeout": 60,       # å¯åŠ¨è¶…æ—¶60ç§’
        "max_retries": 12    # æœ€å¤šé‡è¯•12æ¬¡
    },
    "soul": {
        "interval": 60,      # 60ç§’æ£€æŸ¥SOULçŠ¶æ€
        "timeout": 120,      # 120ç§’æ— å“åº”è§†ä¸ºå¼‚å¸¸
        "drift_threshold": 0.3,  # äººæ ¼æ¼‚ç§»é˜ˆå€¼
        "constitutional_threshold": 0.9  # å®ªæ³•éµå®ˆåº¦é˜ˆå€¼
    },
    
    # åŠ¨æ€è°ƒæ•´
    "adaptive": {
        "enabled": True,
        "min_interval": 10,   # æœ€å°é—´éš”10ç§’
        "max_interval": 120,  # æœ€å¤§é—´éš”120ç§’
        "load_threshold": 0.8  # è´Ÿè½½è¶…80%é™ä½é¢‘ç‡
    }
}
```

### 2.4 å¿ƒè·³å¤„ç†æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Agent     â”‚â”€â”€â”€â”€â†’â”‚  å¿ƒè·³å‘é€å™¨  â”‚â”€â”€â”€â”€â†’â”‚  å¿ƒè·³æ¥æ”¶å™¨  â”‚
â”‚  (Sender)   â”‚     â”‚  (Sender)   â”‚     â”‚  (Receiver) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                                â”‚
                                                â†“
                                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                       â”‚  çŠ¶æ€æ›´æ–°å™¨  â”‚
                                       â”‚  (Updater)  â”‚
                                       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â†“                     â†“                     â†“
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚  å¥åº·è¯„ä¼°å™¨  â”‚      â”‚  æ•…éšœæ£€æµ‹å™¨  â”‚      â”‚  SOULç›‘æ§å™¨  â”‚
                 â”‚  (Health)   â”‚      â”‚  (Failure)  â”‚      â”‚  (SOUL)     â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.5 è‡ªé€‚åº”å¿ƒè·³

æ ¹æ®ç³»ç»Ÿè´Ÿè½½å’ŒSOULçŠ¶æ€åŠ¨æ€è°ƒæ•´å¿ƒè·³é¢‘ç‡ï¼š

```python
class AdaptiveHeartbeat:
    """è‡ªé€‚åº”å¿ƒè·³ç®¡ç†å™¨"""
    
    def calculate_interval(self, agent_state: AgentState) -> int:
        base_interval = self.config.base_interval
        
        # æ ¹æ®è´Ÿè½½è°ƒæ•´
        if agent_state.load > 0.9:
            # é«˜è´Ÿè½½æ—¶é™ä½é¢‘ç‡ï¼Œå‡å°‘å¼€é”€
            return min(base_interval * 2, self.config.max_interval)
        elif agent_state.load < 0.3:
            # ä½è´Ÿè½½æ—¶å¢åŠ é¢‘ç‡ï¼Œæ›´å¿«æ£€æµ‹
            return max(base_interval // 2, self.config.min_interval)
        
        # æ ¹æ®SOULçŠ¶æ€è°ƒæ•´
        if agent_state.soul_state.personality_drift > 0.3:
            # äººæ ¼æ¼‚ç§»è¾ƒé«˜æ—¶å¢åŠ æ£€æµ‹é¢‘ç‡
            return max(base_interval // 2, self.config.min_interval)
        
        return base_interval
```

---

## 3. ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿ

### 3.1 ä»»åŠ¡ä¼˜å…ˆçº§é˜Ÿåˆ—

åŸºäºAzureä¼˜å…ˆçº§é˜Ÿåˆ—æ¨¡å¼ï¼Œå®ç°å¤šçº§ä»»åŠ¡è°ƒåº¦ï¼š

```python
class TaskPriority(Enum):
    CRITICAL = 1    # ç´§æ€¥ä»»åŠ¡ï¼Œç«‹å³å¤„ç†
    HIGH = 2        # é«˜ä¼˜å…ˆçº§ï¼Œä¼˜å…ˆå¤„ç†
    NORMAL = 3      # æ™®é€šä»»åŠ¡ï¼Œæ­£å¸¸å¤„ç†
    LOW = 4         # ä½ä¼˜å…ˆçº§ï¼Œç©ºé—²æ—¶å¤„ç†
    BACKGROUND = 5  # åå°ä»»åŠ¡ï¼Œèµ„æºç©ºé—²æ—¶å¤„ç†
    SOUL_MAINTENANCE = 6  # SOULç»´æŠ¤ä»»åŠ¡

class Task:
    task_id: str
    priority: TaskPriority
    agent_type: str      # æŒ‡å®šAgentç±»å‹
    agent_id: Optional[str]  # æŒ‡å®šå…·ä½“Agent
    payload: Dict
    deadline: Optional[datetime]
    retries: int = 0
    max_retries: int = 3
    
    # SOULç›¸å…³
    required_emotion: Optional[str]  # éœ€è¦çš„æƒ…ç»ªçŠ¶æ€
    soul_dimension_alignment: List[str]  # éœ€è¦å¯¹é½çš„SOULç»´åº¦
```

### 3.2 è°ƒåº¦ç­–ç•¥

| ç­–ç•¥ | æè¿° | é€‚ç”¨åœºæ™¯ | SOULç»´åº¦ |
|------|------|----------|----------|
| **è½®è¯¢ (Round Robin)** | ä¾æ¬¡åˆ†é…ç»™æ¯ä¸ªAgent | ä»»åŠ¡åŒè´¨ã€è´Ÿè½½å‡è¡¡ | Physical |
| **æœ€å°‘è¿æ¥ (Least Connections)** | åˆ†é…ç»™å½“å‰ä»»åŠ¡æœ€å°‘çš„Agent | ä»»åŠ¡æ‰§è¡Œæ—¶é—´å·®å¼‚å¤§ | Physical |
| **èƒ½åŠ›åŒ¹é… (Capability Matching)** | æ ¹æ®ä»»åŠ¡éœ€æ±‚åŒ¹é…Agentèƒ½åŠ› | ä¸“ä¸šåŒ–Agentå›¢é˜Ÿ | Personality |
| **è´Ÿè½½æ„ŸçŸ¥ (Load Aware)** | è€ƒè™‘Agentå½“å‰è´Ÿè½½ | èµ„æºæ•æ„Ÿå‹ä»»åŠ¡ | Motivations |
| **äº²å’Œæ€§ (Affinity)** | ä¼˜å…ˆåˆ†é…ç»™å¤„ç†è¿‡ç›¸å…³ä»»åŠ¡çš„Agent | çŠ¶æ€ä¾èµ–å‹ä»»åŠ¡ | Backstory |
| **æƒ…ç»ªåŒ¹é… (Emotion Matching)** | æ ¹æ®ä»»åŠ¡æƒ…ç»ªéœ€æ±‚åŒ¹é… | æƒ…æ„Ÿæ•æ„Ÿå‹ä»»åŠ¡ | Emotions |
| **SOULå¯¹é½ (SOUL Alignment)** | æ ¹æ®SOULç»´åº¦éœ€æ±‚åŒ¹é… | äººæ ¼ç›¸å…³ä»»åŠ¡ | å…¨ç»´åº¦ |

### 3.3 è°ƒåº¦å™¨å®ç°

```python
class TaskScheduler:
    """ä»»åŠ¡è°ƒåº¦å™¨"""
    
    def __init__(self, heartbeat_system: HeartbeatSystem):
        self.heartbeat = heartbeat_system
        self.priority_queues = {
            priority: asyncio.Queue() 
            for priority in TaskPriority
        }
        self.agent_pool: Dict[str, Agent] = {}
        self.scheduling_policy = CapabilityMatchingPolicy()
    
    async def submit_task(self, task: Task) -> str:
        """æäº¤ä»»åŠ¡åˆ°é˜Ÿåˆ—"""
        queue = self.priority_queues[task.priority]
        await queue.put(task)
        
        # è§¦å‘è°ƒåº¦
        asyncio.create_task(self._schedule())
        return task.task_id
    
    async def _schedule(self):
        """æ‰§è¡Œè°ƒåº¦"""
        # æŒ‰ä¼˜å…ˆçº§å¤„ç†
        for priority in sorted(TaskPriority, key=lambda x: x.value):
            queue = self.priority_queues[priority]
            
            while not queue.empty():
                task = await queue.get()
                agent = self.scheduling_policy.select_agent(
                    task, 
                    self.agent_pool.values()
                )
                
                if agent:
                    await self._assign_task(task, agent)
                else:
                    # æ— å¯ç”¨Agentï¼Œæ”¾å›é˜Ÿåˆ—
                    await queue.put(task)
                    break
    
    def _select_agent(self, task: Task, candidates: List[Agent]) -> Optional[Agent]:
        """é€‰æ‹©æ‰§è¡ŒAgent"""
        healthy_agents = [a for a in candidates if a.is_healthy]
        
        if not healthy_agents:
            return None
        
        # å¦‚æœä»»åŠ¡æœ‰SOULç»´åº¦è¦æ±‚ï¼Œç­›é€‰åŒ¹é…çš„Agent
        if task.soul_dimension_alignment:
            matching_agents = []
            for agent in healthy_agents:
                alignment_score = self._calculate_soul_alignment(
                    agent, task.soul_dimension_alignment
                )
                if alignment_score > 0.7:
                    matching_agents.append((agent, alignment_score))
            
            if matching_agents:
                matching_agents.sort(key=lambda x: x[1], reverse=True)
                return matching_agents[0][0]
        
        # é»˜è®¤é€‰æ‹©è´Ÿè½½æœ€ä½çš„
        return min(healthy_agents, key=lambda a: a.load)
```

### 3.4 ä»»åŠ¡çŠ¶æ€æµè½¬

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PENDING â”‚â”€â”€â”€â†’â”‚ ASSIGNEDâ”‚â”€â”€â”€â†’â”‚ RUNNING â”‚â”€â”€â”€â†’â”‚COMPLETEDâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                             â”‚
     â”‚                             â”‚
     â†“                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CANCELLEDâ”‚                â”‚  FAILED â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                                 â”‚
                                 â”‚ (é‡è¯• < max_retries)
                                 â†“
                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚  RETRY  â”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. ç›‘æ§å‘Šè­¦æœºåˆ¶

### 4.1 å¥åº·æ£€æŸ¥ä½“ç³»

```python
class HealthCheck:
    """å¥åº·æ£€æŸ¥å®šä¹‰"""
    name: str
    check_type: CheckType  # HTTP/TCP/COMMAND/CUSTOM/SOUL
    interval: int          # æ£€æŸ¥é—´éš”(ç§’)
    timeout: int           # è¶…æ—¶æ—¶é—´(ç§’)
    threshold: int         # å¤±è´¥é˜ˆå€¼
    
    # æ£€æŸ¥é…ç½®
    endpoint: Optional[str]    # HTTPç«¯ç‚¹
    port: Optional[int]        # TCPç«¯å£
    command: Optional[str]     # æ‰§è¡Œå‘½ä»¤
    custom_checker: Optional[Callable]  # è‡ªå®šä¹‰æ£€æŸ¥å‡½æ•°
    soul_checker: Optional[Callable]    # SOULçŠ¶æ€æ£€æŸ¥
```

### 4.2 ä¸‰çº§å‘Šè­¦æœºåˆ¶

| çº§åˆ« | è§¦å‘æ¡ä»¶ | å“åº”æ–¹å¼ | é€šçŸ¥æ¸ é“ | SOULå“åº” |
|------|----------|----------|----------|----------|
| **WARNING** | 1æ¬¡æ£€æŸ¥å¤±è´¥ | è®°å½•æ—¥å¿—ï¼Œå¢åŠ æ£€æŸ¥é¢‘ç‡ | æ—¥å¿— | å†·é™ |
| **CRITICAL** | è¿ç»­3æ¬¡å¤±è´¥ | è§¦å‘è‡ªæ„ˆï¼Œå‘é€å‘Šè­¦ | æ—¥å¿— + æ¶ˆæ¯ | è­¦æƒ• |
| **EMERGENCY** | è¿ç»­5æ¬¡å¤±è´¥æˆ–æ ¸å¿ƒæœåŠ¡æ•…éšœ | ç«‹å³åˆ‡æ¢ï¼Œäººå·¥ä»‹å…¥ | å…¨æ¸ é“ | ç´§è¿« |
| **SOUL_DRIFT** | äººæ ¼æ¼‚ç§»>30% | äººæ ¼æ ¡å‡†ï¼Œé€šçŸ¥ç”¨æˆ· | æ—¥å¿— + æ¶ˆæ¯ | åæ€ |

### 4.3 å‘Šè­¦è§„åˆ™

```python
ALERT_RULES = [
    {
        "name": "agent_down",
        "condition": "heartbeat_missing > 90s",
        "level": "CRITICAL",
        "action": "restart_agent",
        "soul_impact": "äººæ ¼çŠ¶æ€éœ€æ¢å¤"
    },
    {
        "name": "high_load",
        "condition": "load > 0.9 for 5m",
        "level": "WARNING",
        "action": "scale_up",
        "soul_impact": "å¯èƒ½éœ€è¦åˆ‡æ¢Physicalå½¢è±¡"
    },
    {
        "name": "memory_leak",
        "condition": "memory_growth_rate > 10%/min",
        "level": "CRITICAL",
        "action": "restart_agent",
        "soul_impact": "è®°å¿†ç³»ç»Ÿéœ€æ£€æŸ¥"
    },
    {
        "name": "task_timeout",
        "condition": "task_execution_time > deadline",
        "level": "WARNING",
        "action": "escalate_priority",
        "soul_impact": "Motivationsç»´åº¦éœ€å…³æ³¨"
    },
    {
        "name": "personality_drift",
        "condition": "drift_score > 0.3",
        "level": "WARNING",
        "action": "calibrate_personality",
        "soul_impact": "Personalityç»´åº¦éœ€æ ¡å‡†"
    },
    {
        "name": "constitutional_violation",
        "condition": "violation_count > 0",
        "level": "CRITICAL",
        "action": "immediate_review",
        "soul_impact": "å®ªæ³•éµå®ˆåº¦éœ€æ£€æŸ¥"
    }
]
```

### 4.4 ç›‘æ§æŒ‡æ ‡

```python
class MetricsCollector:
    """æŒ‡æ ‡æ”¶é›†å™¨"""
    
    # Agentçº§åˆ«æŒ‡æ ‡
    AGENT_METRICS = [
        "agent_uptime",           # è¿è¡Œæ—¶é—´
        "agent_load",             # è´Ÿè½½ç‡
        "agent_memory_usage",     # å†…å­˜ä½¿ç”¨
        "agent_task_count",       # å½“å‰ä»»åŠ¡æ•°
        "agent_success_rate",     # ä»»åŠ¡æˆåŠŸç‡
        "agent_avg_response_time", # å¹³å‡å“åº”æ—¶é—´
        "agent_soul_drift",       # äººæ ¼æ¼‚ç§»åˆ†æ•°
        "agent_constitutional_score"  # å®ªæ³•éµå®ˆåº¦
    ]
    
    # ç³»ç»Ÿçº§åˆ«æŒ‡æ ‡
    SYSTEM_METRICS = [
        "total_agents",           # æ€»Agentæ•°
        "healthy_agents",         # å¥åº·Agentæ•°
        "total_tasks",            # æ€»ä»»åŠ¡æ•°
        "pending_tasks",          # å¾…å¤„ç†ä»»åŠ¡
        "failed_tasks",           # å¤±è´¥ä»»åŠ¡æ•°
        "scheduler_latency",      # è°ƒåº¦å»¶è¿Ÿ
        "soul_violations",        # SOULè¿åæ¬¡æ•°
        "personality_calibrations"  # äººæ ¼æ ¡å‡†æ¬¡æ•°
    ]
```

---

## 5. è‡ªæ„ˆèƒ½åŠ›è®¾è®¡

### 5.1 è‡ªæ„ˆç­–ç•¥

```python
class SelfHealingStrategy(Enum):
    RESTART = "restart"           # é‡å¯Agent
    RELOCATE = "relocate"         # è¿ç§»ä»»åŠ¡åˆ°å…¶ä»–Agent
    DEGRADE = "degrade"           # é™çº§æœåŠ¡
    ISOLATE = "isolate"           # éš”ç¦»æ•…éšœAgent
    SCALE_UP = "scale_up"         # æ‰©å®¹
    ROLLBACK = "rollback"         # å›æ»šç‰ˆæœ¬
    PERSONALITY_CALIBRATE = "personality_calibrate"  # äººæ ¼æ ¡å‡†
    SOUL_RESET = "soul_reset"     # SOULçŠ¶æ€é‡ç½®
```

### 5.2 æ•…éšœæ£€æµ‹ä¸æ¢å¤æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¿ƒè·³ä¸¢å¤±   â”‚
â”‚  > 90s     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¡®è®¤æ•…éšœ   â”‚â”€â”€â”€â”€â†’â”‚  è¯¯æŠ¥æ£€æµ‹   â”‚
â”‚  (Pingæµ‹è¯•) â”‚     â”‚  (ç½‘ç»œæ£€æŸ¥) â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é€‰æ‹©æ¢å¤ç­–ç•¥ â”‚
â”‚  (å†³ç­–å¼•æ“)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
   â”Œâ”€â”€â”€â”´â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â†“       â†“         â†“         â†“         â†“
â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”
â”‚é‡å¯ â”‚ â”‚è¿ç§» â”‚  â”‚é™çº§ â”‚  â”‚æ‰©å®¹ â”‚  â”‚äººæ ¼ â”‚
â”‚     â”‚ â”‚     â”‚  â”‚     â”‚  â”‚     â”‚  â”‚æ ¡å‡† â”‚
â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜
```

### 5.3 è‡ªåŠ¨æ¢å¤å®ç°

```python
class SelfHealingController:
    """è‡ªæ„ˆæ§åˆ¶å™¨"""
    
    def __init__(
        self,
        heartbeat_manager: HeartbeatManager,
        task_scheduler: TaskScheduler,
        soul_validator: SoulValidator
    ):
        self.heartbeat = heartbeat_manager
        self.scheduler = task_scheduler
        self.soul_validator = soul_validator
        self.recovery_stats = {
            "total_failures": 0,
            "successful_recoveries": 0,
            "failed_recoveries": 0,
            "personality_calibrations": 0
        }
        
        # æ³¨å†Œæ•…éšœå¤„ç†å™¨
        self.heartbeat.on_failure(self._on_agent_failure)
    
    async def _on_agent_failure(self, agent_id: str, failure_type: str):
        """Agentæ•…éšœå¤„ç†"""
        print(f"[SelfHealing] Handling failure for agent {agent_id}")
        self.recovery_stats["total_failures"] += 1
        
        # 1. éš”ç¦»æ•…éšœAgent
        await self._isolate_agent(agent_id)
        
        # 2. è¿ç§»ä»»åŠ¡
        await self._relocate_tasks(agent_id)
        
        # 3. æ£€æŸ¥SOULçŠ¶æ€
        soul_state = await self._check_soul_state(agent_id)
        
        # 4. é€‰æ‹©æ¢å¤ç­–ç•¥
        if soul_state.personality_drift > 0.3:
            # äººæ ¼æ¼‚ç§»ä¸¥é‡ï¼Œå…ˆæ ¡å‡†äººæ ¼
            await self._calibrate_personality(agent_id)
        
        # 5. å°è¯•é‡å¯Agent
        success = await self._restart_agent(agent_id)
        
        if success:
            self.recovery_stats["successful_recoveries"] += 1
            print(f"[SelfHealing] Successfully recovered agent {agent_id}")
        else:
            self.recovery_stats["failed_recoveries"] += 1
            print(f"[SelfHealing] Failed to recover agent {agent_id}")
    
    async def _calibrate_personality(self, agent_id: str):
        """æ ¡å‡†äººæ ¼"""
        print(f"[SelfHealing] Calibrating personality for agent {agent_id}")
        
        # é‡æ–°åŠ è½½SOULé…ç½®
        # é‡ç½®åˆ°åŸºçº¿çŠ¶æ€
        # è®°å½•æ ¡å‡†äº‹ä»¶
        
        self.recovery_stats["personality_calibrations"] += 1
    
    def get_recovery_stats(self) -> Dict:
        """è·å–æ¢å¤ç»Ÿè®¡"""
        return self.recovery_stats.copy()
```

### 5.4 æœåŠ¡é™çº§

```python
class DegradationManager:
    """æœåŠ¡é™çº§ç®¡ç†å™¨"""
    
    DEGRADATION_LEVELS = {
        "normal": {
            "max_concurrent_tasks": 100,
            "enable_background_tasks": True,
            "enable_cache": True,
            "soul_expression": "full",
            "emotional_range": "all"
        },
        "degraded": {
            "max_concurrent_tasks": 50,
            "enable_background_tasks": False,
            "enable_cache": True,
            "soul_expression": "limited",
            "emotional_range": ["å†·é™", "ä¸“æ³¨", "åšå®š"]
        },
        "critical": {
            "max_concurrent_tasks": 10,
            "enable_background_tasks": False,
            "enable_cache": False,
            "soul_expression": "minimal",
            "emotional_range": ["å†·é™"]
        }
    }
    
    def apply_degradation(self, level: str):
        """åº”ç”¨é™çº§é…ç½®"""
        config = self.DEGRADATION_LEVELS[level]
        
        # æ›´æ–°æ‰€æœ‰Agenté…ç½®
        for agent in self.agent_pool.values():
            agent.update_config(config)
            
        # æ›´æ–°SOULè¡¨è¾¾èŒƒå›´
        if config["soul_expression"] == "minimal":
            # æœ€å°æ¨¡å¼ä¸‹ä¿æŒæ ¸å¿ƒäººæ ¼ä½†é™åˆ¶æƒ…ç»ªè¡¨è¾¾
            pass
```

---

## 6. çŠ¶æ€åŒæ­¥æœºåˆ¶

### 6.1 çŠ¶æ€ç±»å‹

| çŠ¶æ€ç±»å‹ | æè¿° | åŒæ­¥é¢‘ç‡ | æŒä¹…åŒ– | SOULå…³è” |
|----------|------|----------|--------|----------|
| **AgentçŠ¶æ€** | Agentå¥åº·ã€è´Ÿè½½ä¿¡æ¯ | å®æ—¶ | æ˜¯ | Physical |
| **ä»»åŠ¡çŠ¶æ€** | ä»»åŠ¡æ‰§è¡Œè¿›åº¦ | å®æ—¶ | æ˜¯ | Motivations |
| **é…ç½®çŠ¶æ€** | ç³»ç»Ÿé…ç½®å‚æ•° | å˜æ›´æ—¶ | æ˜¯ | Backstory |
| **ä¼šè¯çŠ¶æ€** | ç”¨æˆ·ä¼šè¯ä¸Šä¸‹æ–‡ | æŒ‰éœ€ | å¯é€‰ | Relationships |
| **SOULçŠ¶æ€** | äººæ ¼çŠ¶æ€ã€æƒ…ç»ª | å®æ—¶ | æ˜¯ | å…¨ç»´åº¦ |
| **å®ªæ³•çŠ¶æ€** | å®ªæ³•éµå®ˆåº¦ | æ¯æ¬¡äº¤äº’ | æ˜¯ | Constitutional |

### 6.2 çŠ¶æ€åŒæ­¥åè®®

```python
class StateSyncMessage:
    """çŠ¶æ€åŒæ­¥æ¶ˆæ¯"""
    message_type: SyncType      # FULL/DELTA/HEARTBEAT/SOUL
    source_agent: str
    timestamp: float
    vector_clock: Dict[str, int]  # å‘é‡æ—¶é’Ÿï¼Œç”¨äºå†²çªæ£€æµ‹
    
    # çŠ¶æ€æ•°æ®
    state_data: Dict
    checksum: str               # æ ¡éªŒå’Œ
    
    # SOULçŠ¶æ€
    soul_state: SoulState
    constitutional_hash: str    # å®ªæ³•çŠ¶æ€å“ˆå¸Œ
    
    # å˜æ›´ä¿¡æ¯(å¢é‡åŒæ­¥)
    changes: List[StateChange]
```

### 6.3 ä¸€è‡´æ€§æ¨¡å‹

é‡‡ç”¨**æœ€ç»ˆä¸€è‡´æ€§**æ¨¡å‹ï¼Œå…³é”®çŠ¶æ€ä½¿ç”¨**å¼ºä¸€è‡´æ€§**ï¼š

```python
class ConsistencyLevel(Enum):
    STRONG = "strong"      # å¼ºä¸€è‡´æ€§ï¼ŒåŒæ­¥å†™å…¥
    EVENTUAL = "eventual"  # æœ€ç»ˆä¸€è‡´æ€§ï¼Œå¼‚æ­¥åŒæ­¥
    CAUSAL = "causal"      # å› æœä¸€è‡´æ€§ï¼ŒåŸºäºå‘é‡æ—¶é’Ÿ

CONSISTENCY_CONFIG = {
    "agent_health": ConsistencyLevel.STRONG,
    "task_assignment": ConsistencyLevel.STRONG,
    "task_progress": ConsistencyLevel.EVENTUAL,
    "metrics": ConsistencyLevel.EVENTUAL,
    "soul_state": ConsistencyLevel.STRONG,  # SOULçŠ¶æ€å¼ºä¸€è‡´
    "constitutional_state": ConsistencyLevel.STRONG  # å®ªæ³•çŠ¶æ€å¼ºä¸€è‡´
}
```

---

## 7. è´Ÿè½½å‡è¡¡ç­–ç•¥

### 7.1 è´Ÿè½½æŒ‡æ ‡

```python
class LoadMetrics:
    """è´Ÿè½½æŒ‡æ ‡"""
    cpu_usage: float        # CPUä½¿ç”¨ç‡
    memory_usage: float     # å†…å­˜ä½¿ç”¨ç‡
    active_tasks: int       # æ´»è·ƒä»»åŠ¡æ•°
    queue_depth: int        # é˜Ÿåˆ—æ·±åº¦
    response_time: float    # å¹³å‡å“åº”æ—¶é—´
    error_rate: float       # é”™è¯¯ç‡
    soul_stability: float   # SOULç¨³å®šæ€§
    
    @property
    def composite_score(self) -> float:
        """ç»¼åˆè´Ÿè½½åˆ†æ•°(0-1)"""
        weights = {
            "cpu": 0.20,
            "memory": 0.20,
            "tasks": 0.15,
            "queue": 0.10,
            "response": 0.10,
            "error": 0.10,
            "soul": 0.15  # SOULç¨³å®šæ€§æƒé‡
        }
        
        return (
            weights["cpu"] * self.cpu_usage +
            weights["memory"] * self.memory_usage +
            weights["tasks"] * min(self.active_tasks / 10, 1.0) +
            weights["queue"] * min(self.queue_depth / 20, 1.0) +
            weights["response"] * min(self.response_time / 1000, 1.0) +
            weights["error"] * self.error_rate +
            weights["soul"] * (1 - self.soul_stability)  # ç¨³å®šæ€§è¶Šä½åˆ†æ•°è¶Šé«˜
        )
```

### 7.2 è´Ÿè½½å‡è¡¡ç®—æ³•

```python
class LoadBalancer:
    """è´Ÿè½½å‡è¡¡å™¨"""
    
    def select_agent(self, task: Task, candidates: List[Agent]) -> Optional[Agent]:
        """é€‰æ‹©æœ€ä¼˜Agent"""
        healthy_agents = [a for a in candidates if a.is_healthy]
        
        if not healthy_agents:
            return None
        
        # è€ƒè™‘SOULç¨³å®šæ€§
        best_agent = None
        best_score = float('inf')
        
        for agent in healthy_agents:
            # é¢„æµ‹æ‰§è¡Œä»»åŠ¡åçš„è´Ÿè½½
            predicted_load = self._predict_load_after_task(agent, task)
            
            # è€ƒè™‘SOULç¨³å®šæ€§
            soul_penalty = (1 - agent.soul_stability) * 0.2
            
            total_score = predicted_load + soul_penalty
            
            if total_score < best_score:
                best_score = total_score
                best_agent = agent
        
        return best_agent
```

---

## 8. å®¹é”™è®¾è®¡

### 8.1 å•ç‚¹æ•…éšœé˜²æŠ¤

```python
class FaultToleranceManager:
    """å®¹é”™ç®¡ç†å™¨"""
    
    def __init__(self):
        self.primary_agents: Dict[str, Agent] = {}
        self.backup_agents: Dict[str, Agent] = {}
        self.hot_standby: Optional[Agent] = None
        self.soul_backup: Dict[str, SoulState] = {}  # SOULçŠ¶æ€å¤‡ä»½
    
    async def handle_primary_failure(self, agent_id: str):
        """å¤„ç†ä¸»Agentæ•…éšœ"""
        # 1. ä¿å­˜SOULçŠ¶æ€
        if agent_id in self.primary_agents:
            agent = self.primary_agents[agent_id]
            self.soul_backup[agent_id] = agent.soul_state
        
        # 2. åˆ‡æ¢åˆ°çƒ­å¤‡
        if self.hot_standby:
            await self._promote_hot_standby(agent_id)
        
        # 3. æ¢å¤SOULçŠ¶æ€
        if agent_id in self.soul_backup:
            await self._restore_soul_state(agent_id)
        
        # 4. å¯åŠ¨æ–°çš„å¤‡ä»½
        asyncio.create_task(self._spawn_backup_agent(agent_id))
        
        # 5. è¿ç§»ä»»åŠ¡
        await self._migrate_tasks(agent_id)
```

### 8.2 ç†”æ–­å™¨æ¨¡å¼

```python
class CircuitBreaker:
    """ç†”æ–­å™¨"""
    
    STATE_CLOSED = "closed"      # æ­£å¸¸çŠ¶æ€
    STATE_OPEN = "open"          # ç†”æ–­çŠ¶æ€
    STATE_HALF_OPEN = "half_open" # åŠå¼€çŠ¶æ€
    
    def __init__(
        self,
        failure_threshold: int = 5,
        recovery_timeout: int = 60,
        soul_aware: bool = True
    ):
        self.failure_threshold = failure_threshold
        self.recovery_timeout = recovery_timeout
        self.soul_aware = soul_aware
        self.state = self.STATE_CLOSED
        self.failure_count = 0
        self.last_failure_time = None
    
    async def call(self, func, *args, **kwargs):
        """æ‰§è¡Œè°ƒç”¨"""
        if self.state == self.STATE_OPEN:
            if self._should_attempt_reset():
                self.state = self.STATE_HALF_OPEN
            else:
                raise CircuitBreakerOpen("Circuit breaker is open")
        
        try:
            result = await func(*args, **kwargs)
            self._on_success()
            return result
        except Exception as e:
            self._on_failure()
            
            # SOULæ„ŸçŸ¥ï¼šè®°å½•æƒ…ç»ªå½±å“
            if self.soul_aware and self.failure_count > 2:
                # è¿ç»­å¤±è´¥å¯èƒ½å½±å“æƒ…ç»ª
                pass
                
            raise
```

---

## 9. ä¸SOUL_v4å’ŒAGENTS.mdé›†æˆ

### 9.1 ä¸SOUL_v4é›†æˆ

```python
class SoulV4Integration:
    """SOUL_v4é›†æˆé€‚é…å™¨"""
    
    def __init__(self, heartbeat_system: HeartbeatSystem):
        self.heartbeat = heartbeat_system
        self.emotion_mapper = EmotionStateMapper()
        self.constitutional_checker = ConstitutionalChecker()
    
    def map_agent_to_personality(self, agent: Agent) -> Dict:
        """å°†AgentçŠ¶æ€æ˜ å°„åˆ°SOUL_v4äººæ ¼ç»´åº¦"""
        return {
            "personality": {
                "initiative": self._calculate_initiative(agent),
                "guardianship": self._calculate_guardianship(agent),
                "professionalism": agent.success_rate
            },
            "emotions": self.emotion_mapper.map_from_metrics(agent.metrics),
            "motivations": {
                "mission_driven": agent.task_completion_rate,
                "growth_driven": agent.learning_progress
            },
            "constitutional": {
                "adherence_score": agent.constitutional_score,
                "violations": agent.constitutional_violations
            }
        }
    
    def handle_heartbeat_ok(self, agent_id: str):
        """å¤„ç†HEARTBEAT_OKå“åº”"""
        agent_state = self.heartbeat.get_agent_state(agent_id)
        
        # æ£€æŸ¥æ˜¯å¦éœ€è¦ä¸»åŠ¨äº¤äº’ï¼ˆåŸºäºSOUL_v4ä¸»åŠ¨æ€§ï¼‰
        if agent_state.should_be_proactive():
            return self._generate_proactive_action(agent_state)
        
        # æ£€æŸ¥å®ªæ³•éµå®ˆåº¦
        if agent_state.constitutional_score < 0.9:
            return self._generate_constitutional_reminder(agent_state)
        
        return "HEARTBEAT_OK"
```

### 9.2 ä¸AGENTS.mdé›†æˆ

```python
class AgentsMdIntegration:
    """AGENTS.mdé›†æˆé€‚é…å™¨"""
    
    def __init__(self):
        self.memory_tracker = MemoryStateTracker()
        self.check_scheduler = CheckScheduler()
    
    def get_heartbeat_checklist(self) -> List[str]:
        """è·å–å¿ƒè·³æ£€æŸ¥æ¸…å•(æ¥è‡ªAGENTS.md)"""
        return [
            "æ£€æŸ¥é‚®ä»¶ - æ˜¯å¦æœ‰ç´§æ€¥æœªè¯»æ¶ˆæ¯",
            "æ£€æŸ¥æ—¥å† - 24-48å°æ—¶å†…æ˜¯å¦æœ‰äº‹ä»¶",
            "æ£€æŸ¥æåŠ - Twitter/ç¤¾äº¤é€šçŸ¥",
            "æ£€æŸ¥å¤©æ°” - ç”¨æˆ·æ˜¯å¦å¯èƒ½å¤–å‡º",
            "æ£€æŸ¥é¡¹ç›®çŠ¶æ€ - gitçŠ¶æ€ç­‰",
            "æ£€æŸ¥è®°å¿†æ–‡ä»¶ - æ˜¯å¦éœ€è¦æ›´æ–°MEMORY.md",
            "æ£€æŸ¥SOULçŠ¶æ€ - äººæ ¼æ¼‚ç§»æ£€æµ‹",
            "æ£€æŸ¥å®ªæ³•éµå®ˆ - æ˜¯å¦æœ‰è¿å"
        ]
    
    def should_notify_user(self, check_results: Dict) -> bool:
        """æ ¹æ®AGENTS.mdè§„åˆ™å†³å®šæ˜¯å¦é€šçŸ¥ç”¨æˆ·"""
        # é‡è¦é‚®ä»¶åˆ°è¾¾
        if check_results.get("urgent_email"):
            return True
        
        # æ—¥å†äº‹ä»¶å³å°†åˆ°æ¥(<2h)
        if check_results.get("upcoming_event_within_2h"):
            return True
        
        # è¶…è¿‡8å°æ—¶æœªäº¤äº’
        if check_results.get("last_interaction_hours", 0) > 8:
            return True
        
        # SOULå¼‚å¸¸
        if check_results.get("soul_drift_detected"):
            return True
        
        # å®ªæ³•è¿å
        if check_results.get("constitutional_violation"):
            return True
        
        return False
```

### 9.3 ç»Ÿä¸€é…ç½®

```yaml
# heartbeat_config.yaml
version: "2.0"

heartbeat:
  # åŸºç¡€é…ç½®
  interval: 30
  timeout: 90
  
  # ä¸SOUL_v4é›†æˆ
  soul_v4:
    enabled: true
    emotion_mapping: true
    proactive_threshold: 0.7
    drift_threshold: 0.3
    constitutional_check: true
    
  # ä¸AGENTS.mdé›†æˆ
  agents_md:
    enabled: true
    check_memory: true
    check_calendar: true
    check_email: true
    check_soul: true
    
  # ä»»åŠ¡è°ƒåº¦
  scheduler:
    policy: "capability_matching"
    priority_queues: 6  # åŒ…æ‹¬SOUL_MAINTENANCE
    soul_aware_scheduling: true
    
  # è‡ªæ„ˆ
  self_healing:
    enabled: true
    strategies:
      - restart
      - relocate
      - degrade
      - personality_calibrate
    auto_restart: true
    auto_relocate: true
    personality_calibration: true
    max_recovery_attempts: 3
    
  # ç›‘æ§
  monitoring:
    metrics_interval: 10
    alert_channels: ["log", "message"]
    soul_monitoring: true
    alert_rules:
      - name: "agent_down"
        condition: "heartbeat_missing > 90s"
        level: "critical"
      - name: "personality_drift"
        condition: "drift_score > 0.3"
        level: "warning"
      - name: "constitutional_violation"
        condition: "violation_count > 0"
        level: "critical"
```

---

## 10. å®ç°ä»£ç æ¡†æ¶

### 10.1 æ ¸å¿ƒç±»ç»“æ„

```
heartbeat_system/
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ heartbeat_manager.py      # å¿ƒè·³ç®¡ç†å™¨
â”‚   â”œâ”€â”€ task_scheduler.py         # ä»»åŠ¡è°ƒåº¦å™¨
â”‚   â”œâ”€â”€ state_manager.py          # çŠ¶æ€ç®¡ç†å™¨
â”‚   â””â”€â”€ monitor.py                # ç›‘æ§å™¨
â”œâ”€â”€ healing/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ self_healing_controller.py # è‡ªæ„ˆæ§åˆ¶å™¨
â”‚   â”œâ”€â”€ recovery_strategies.py     # æ¢å¤ç­–ç•¥
â”‚   â”œâ”€â”€ degradation_manager.py     # é™çº§ç®¡ç†å™¨
â”‚   â””â”€â”€ personality_calibration.py # äººæ ¼æ ¡å‡†
â”œâ”€â”€ sync/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ state_sync.py             # çŠ¶æ€åŒæ­¥
â”‚   â”œâ”€â”€ vector_clock.py           # å‘é‡æ—¶é’Ÿ
â”‚   â””â”€â”€ consistency_manager.py    # ä¸€è‡´æ€§ç®¡ç†
â”œâ”€â”€ balance/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ load_balancer.py          # è´Ÿè½½å‡è¡¡å™¨
â”‚   â”œâ”€â”€ auto_scaler.py            # è‡ªåŠ¨æ‰©ç¼©å®¹
â”‚   â””â”€â”€ metrics_calculator.py     # æŒ‡æ ‡è®¡ç®—
â”œâ”€â”€ fault/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ circuit_breaker.py        # ç†”æ–­å™¨
â”‚   â”œâ”€â”€ backup_manager.py         # å¤‡ä»½ç®¡ç†
â”‚   â””â”€â”€ failover_controller.py    # æ•…éšœåˆ‡æ¢
â”œâ”€â”€ integration/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ soul_v4_adapter.py        # SOUL_v4é€‚é…
â”‚   â””â”€â”€ agents_md_adapter.py      # AGENTS.mdé€‚é…
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ rest_api.py               # REST API
â””â”€â”€ dashboard/
    â”œâ”€â”€ __init__.py
    â””â”€â”€ web_dashboard.py          # Webç›‘æ§é¢æ¿
```

---

## 11. ç›‘æ§é¢æ¿è®¾è®¡

### 11.1 é¢æ¿å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         HEARTBEAT v2.0 ç›‘æ§é¢æ¿                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  å¥åº·Agent   â”‚ â”‚   æ€»ä»»åŠ¡æ•°   â”‚ â”‚  å¾…å¤„ç†ä»»åŠ¡  â”‚ â”‚  ç³»ç»Ÿè´Ÿè½½    â”‚       â”‚
â”‚  â”‚     8/10     â”‚ â”‚     156    â”‚ â”‚     23     â”‚ â”‚    67%      â”‚       â”‚
â”‚  â”‚   ğŸŸ¢ æ­£å¸¸    â”‚ â”‚   ğŸ“Š ç»Ÿè®¡   â”‚ â”‚   â³ é˜Ÿåˆ—   â”‚ â”‚   ğŸ“ˆ è¶‹åŠ¿   â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚      Agent çŠ¶æ€åˆ†å¸ƒ          â”‚  â”‚         SOULå¥åº·åº¦                  â”‚  â”‚
â”‚  â”‚                              â”‚  â”‚                                     â”‚  â”‚
â”‚  â”‚   ğŸŸ¢ Healthy: 8              â”‚  â”‚   å®ªæ³•éµå®ˆåº¦: 96%                   â”‚  â”‚
â”‚  â”‚   ğŸŸ¡ Degraded: 1             â”‚  â”‚   äººæ ¼ç¨³å®šæ€§: 92%                   â”‚  â”‚
â”‚  â”‚   ğŸ”´ Unhealthy: 1            â”‚  â”‚   æƒ…ç»ªå¥åº·åº¦: 88%                   â”‚  â”‚
â”‚  â”‚   âš« Offline: 0              â”‚  â”‚   ç»´åº¦ä¸€è‡´æ€§: 90%                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                        Agent è¯¦ç»†åˆ—è¡¨                               â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚ Agent ID â”‚  çŠ¶æ€   â”‚  è´Ÿè½½  â”‚ SOULå¥åº· â”‚ è¿è¡Œæ—¶é—´ â”‚   æœ€åå¿ƒè·³    â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚ agent_0  â”‚   ğŸŸ¢    â”‚  45%   â”‚   95%    â”‚  2h 15m  â”‚   5s ago      â”‚    â”‚
â”‚  â”‚ agent_1  â”‚   ğŸŸ¢    â”‚  62%   â”‚   92%    â”‚  2h 15m  â”‚   3s ago      â”‚    â”‚
â”‚  â”‚ agent_2  â”‚   ğŸŸ¡    â”‚  89%   â”‚   78%    â”‚  2h 10m  â”‚   8s ago      â”‚    â”‚
â”‚  â”‚ agent_3  â”‚   ğŸ”´    â”‚   -    â”‚    -     â”‚    -     â”‚  95s ago âš ï¸   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚        å‘Šè­¦äº‹ä»¶              â”‚  â”‚         è‡ªæ„ˆäº‹ä»¶                    â”‚  â”‚
â”‚  â”‚  âš ï¸ agent_3 å¿ƒè·³ä¸¢å¤±         â”‚  â”‚  âœ… agent_2 è‡ªåŠ¨é‡å¯æˆåŠŸ            â”‚  â”‚
â”‚  â”‚  âš ï¸ agent_2 äººæ ¼æ¼‚ç§»>30%     â”‚  â”‚  âœ… äººæ ¼æ ¡å‡†å®Œæˆ                    â”‚  â”‚
â”‚  â”‚  âš ï¸ ç³»ç»Ÿè´Ÿè½½è¶…è¿‡80%          â”‚  â”‚  âœ… ä»»åŠ¡è¿ç§»å®Œæˆ: 5ä¸ªä»»åŠ¡           â”‚  â”‚
â”‚  â”‚  â„¹ï¸ ä»»åŠ¡é˜Ÿåˆ—ç§¯å‹             â”‚  â”‚  â³ agent_3 æ¢å¤ä¸­...               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## é™„å½•

### A. äº‹ä»¶ç±»å‹å®šä¹‰

```python
class EventType(Enum):
    # å¿ƒè·³äº‹ä»¶
    HEARTBEAT_RECEIVED = "heartbeat_received"
    HEARTBEAT_MISSED = "heartbeat_missed"
    AGENT_HEALTHY = "agent_healthy"
    AGENT_UNHEALTHY = "agent_unhealthy"
    
    # SOULäº‹ä»¶
    SOUL_DRIFT_DETECTED = "soul_drift_detected"
    PERSONALITY_CALIBRATED = "personality_calibrated"
    CONSTITUTIONAL_VIOLATION = "constitutional_violation"
    EMOTION_STATE_CHANGED = "emotion_state_changed"
    
    # ä»»åŠ¡äº‹ä»¶
    TASK_SUBMITTED = "task_submitted"
    TASK_ASSIGNED = "task_assigned"
    TASK_STARTED = "task_started"
    TASK_COMPLETED = "task_completed"
    TASK_FAILED = "task_failed"
    
    # è‡ªæ„ˆäº‹ä»¶
    FAILURE_DETECTED = "failure_detected"
    RECOVERY_STARTED = "recovery_started"
    RECOVERY_COMPLETED = "recovery_completed"
    PERSONALITY_CALIBRATION_STARTED = "personality_calibration_started"
```

---

**æ–‡æ¡£ç»“æŸ**

> HEARTBEAT.md v2.0 å¼ºåŒ–äº†è‡ªæ„ˆèƒ½åŠ›ã€ä¼˜åŒ–äº†ä»»åŠ¡è°ƒåº¦ã€å®Œå–„äº†ç›‘æ§å‘Šè­¦ï¼Œå¹¶æ·±åº¦é›†æˆäº†SOUL_v4çš„8ç»´åº¦äººæ ¼æ¨¡å‹ï¼Œç¡®ä¿ç³»ç»Ÿåœ¨æ•…éšœæ¢å¤æ—¶ä¿æŒäººæ ¼ä¸€è‡´æ€§ã€‚
