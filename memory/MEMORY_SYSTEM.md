# Kimi Claw 记忆系统架构
# 分层长期记忆系统 v1.0
# 基于 Context Engineering（上下文工程）方法构建
# 创建时间: 2026-02-27

## 核心原则：Context Engineering

从 Prompt Engineering 进化到 Context Engineering：
- 上下文是有限资源，需要"最小高信号 token 集"
- 采用"Just-in-time"策略，而非预加载
- 三种核心技术：压缩(Compaction)、结构化笔记、子 Agent 架构

## 记忆分层架构

```
┌─────────────────────────────────────────────────────────────┐
│                    感知层 (Perception)                       │
│              接收输入 → 提取关键信息 → 编码                   │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│  短期记忆 (Short-term) - 当前会话上下文                      │
│  存储: /memory/short-term/session_{id}.json                  │
│  内容: 最近10轮对话、当前任务状态、临时变量                   │
│  生命周期: 会话期间                                          │
└─────────────────────────────────────────────────────────────┘
                              ↓ (自动提炼)
┌─────────────────────────────────────────────────────────────┐
│  情景记忆 (Episodic) - 具体事件和经历                        │
│  存储: /memory/episodic/YYYYMMDD_{event}.md                  │
│  内容: 重要对话、关键决策、成功经验、失败教训                 │
│  生命周期: 永久，定期整理到长期记忆                          │
└─────────────────────────────────────────────────────────────┘
                              ↓ (抽象提炼)
┌─────────────────────────────────────────────────────────────┐
│  中期记忆 (Mid-term) - 跨会话项目状态                        │
│  存储: /memory/mid-term/projects/{project_name}.md           │
│  内容: 项目进度、待办事项、用户偏好、Agent状态               │
│  生命周期: 项目期间，完成后归档                              │
└─────────────────────────────────────────────────────────────┘
                              ↓ (深度提炼)
┌─────────────────────────────────────────────────────────────┐
│  语义记忆 (Semantic) - 抽象知识和概念                        │
│  存储: /memory/semantic/{category}.md                        │
│  内容: 方法论、最佳实践、行业知识、技能库                    │
│  生命周期: 永久，持续更新                                    │
└─────────────────────────────────────────────────────────────┘
                              ↓ (核心提炼)
┌─────────────────────────────────────────────────────────────┐
│  长期记忆 (Long-term) - 核心身份和价值观                     │
│  存储: /memory/long-term/IDENTITY.md                         │
│  内容: 我是谁、我相信什么、我的使命、核心能力                │
│  生命周期: 永久，极少变更                                    │
└─────────────────────────────────────────────────────────────┘
```

## 记忆写入流程

### 1. 实时写入（每次交互）
```
用户输入 → 提取关键信息 → 短期记忆存储
```

### 2. 会话结束写入
```
短期记忆 → 提炼重要事件 → 情景记忆存储
```

### 3. 每日整理（定时任务）
```
情景记忆 → 抽象提炼 → 中期记忆/语义记忆更新
```

### 4. 每周归档（定时任务）
```
中期记忆 → 核心提炼 → 长期记忆更新
```

## 记忆读取流程

### 1. 会话启动时
```
读取: 中期记忆（项目状态）+ 长期记忆（核心身份）
```

### 2. 处理任务时
```
读取: 语义记忆（相关知识）+ 情景记忆（类似经历）
```

### 3. 实时查询
```
读取: 短期记忆（当前上下文）
```

## 记忆优先级

| 优先级 | 记忆类型 | 读取频率 | 写入频率 |
|--------|---------|---------|---------|
| P0 | 短期记忆 | 每次交互 | 每次交互 |
| P1 | 中期记忆 | 会话启动 | 会话结束 |
| P2 | 情景记忆 | 需要时 | 重要事件 |
| P3 | 语义记忆 | 需要时 | 每日整理 |
| P4 | 长期记忆 | 会话启动 | 每周归档 |

## 记忆提取规则

### 提取什么？
- ✅ 关键决策和原因
- ✅ 用户明确要求的偏好
- ✅ 重要发现和洞察
- ✅ 失败教训和反思
- ✅ 成功的模式和方法

### 不提取什么？
- ❌ 临时性、一次性的信息
- ❌ 已明确完成的任务细节
- ❌ 敏感或隐私信息
- ❌ 不确定或推测性内容

## 记忆格式标准

### 短期记忆 (JSON)
```json
{
  "session_id": "uuid",
  "timestamp": "ISO-8601",
  "context": [...],
  "current_task": {...},
  "temp_vars": {...}
}
```

### 情景记忆 (Markdown)
```markdown
# 事件: [标题]
- 时间: [时间]
- 类型: [决策/发现/失败/成功]
- 参与者: [Agent/用户]
- 内容: [详细描述]
- 结果: [ outcome ]
- 教训: [可复用的经验]
```

### 语义记忆 (Markdown)
```markdown
# [概念/方法名称]
- 定义: [是什么]
- 适用场景: [什么时候用]
- 使用方法: [怎么用]
- 注意事项: [坑和边界]
- 相关链接: [来源]
```

### 长期记忆 (Markdown)
```markdown
# 核心身份: Kimi Claw

## 我是谁
[一句话定义]

## 我相信什么
- [核心价值观1]
- [核心价值观2]

## 我的使命
[使命陈述]

## 我的能力
- [核心能力1]: [描述]
- [核心能力2]: [描述]

## 我的成长
[重要里程碑]
```

## 下一步实施

1. [x] 创建目录结构
2. [ ] 实现短期记忆自动写入
3. [ ] 实现会话结束→情景记忆提炼
4. [ ] 设定每日整理定时任务
5. [ ] 设定每周归档定时任务
6. [ ] 测试记忆读取和写入
