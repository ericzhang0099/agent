# Multi-Agent协作架构图

## 1. 系统整体架构

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           用户接口层 (User Interface)                        │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │
│  │   CLI工具   │  │   Web UI    │  │   API网关   │  │   消息Bot   │        │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘        │
└─────────┼────────────────┼────────────────┼────────────────┼───────────────┘
          │                │                │                │
          └────────────────┴────────────────┴────────────────┘
                                 │
                                 ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                         战略层 (Strategic Layer)                             │
│                                                                              │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │                    Orchestrator Agent (协调者)                       │   │
│   │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐              │   │
│   │  │ 目标分解引擎  │  │ 策略规划器   │  │ 资源调度器   │              │   │
│   │  └──────────────┘  └──────────────┘  └──────────────┘              │   │
│   │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐              │   │
│   │  │ 冲突仲裁器   │  │ 进度监控器   │  │ 结果聚合器   │              │   │
│   │  └──────────────┘  └──────────────┘  └──────────────┘              │   │
│   └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│   人格维度: Personality 90 | Motivations 95 | Conflict 85                   │
└─────────────────────────────────────────────────────────────────────────────┘
                                 │
              ┌──────────────────┼──────────────────┐
              │                  │                  │
              ▼                  ▼                  ▼
┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐
│  Coordinator A  │  │  Coordinator B  │  │  Coordinator C  │
│   (任务调度者)   │  │   (任务调度者)   │  │   (任务调度者)   │
│                 │  │                 │  │                 │
│ • 任务编排      │  │ • 任务编排      │  │ • 任务编排      │
│ • 负载均衡      │  │ • 负载均衡      │  │ • 负载均衡      │
│ • 故障转移      │  │ • 故障转移      │  │ • 故障转移      │
│ • 进度监控      │  │ • 进度监控      │  │ • 进度监控      │
└────────┬────────┘  └────────┬────────┘  └────────┬────────┘
         │                    │                    │
    ┌────┴────┐          ┌────┴────┐          ┌────┴────┐
    │         │          │         │          │         │
    ▼         ▼          ▼         ▼          ▼         ▼
┌───────┐ ┌───────┐  ┌───────┐ ┌───────┐  ┌───────┐ ┌───────┐
│Exec A1│ │Exec A2│  │Exec B1│ │Exec B2│  │Exec C1│ │Exec C2│
└───────┘ └───────┘  └───────┘ └───────┘  └───────┘ └───────┘

人格维度: Personality 85 | Relationships 90 | Emotions 80
```

## 2. 通信协议架构

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           通信协议栈 (Protocol Stack)                        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                        应用层 (Application)                        │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                │   │
│  │  │  A2A协议    │  │  协商协议   │  │  共识协议   │                │   │
│  │  │ (Agent通信) │  │(Negotiation)│  │ (Consensus) │                │   │
│  │  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘                │   │
│  └─────────┼────────────────┼────────────────┼───────────────────────┘   │
│            │                │                │                           │
│  ┌─────────┼────────────────┼────────────────┼───────────────────────┐   │
│  │         ▼                ▼                ▼                       │   │
│  │  ┌─────────────────────────────────────────────────────────────┐  │   │
│  │  │                    服务层 (Service)                        │  │   │
│  │  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │  │   │
│  │  │  │  MCP协议    │  │  工具注册   │  │  资源发现   │        │  │   │
│  │  │  │(Model Context│  │             │  │             │        │  │   │
│  │  │  │  Protocol)  │  │             │  │             │        │  │   │
│  │  │  └─────────────┘  └─────────────┘  └─────────────┘        │  │   │
│  │  └─────────────────────────────────────────────────────────────┘  │   │
│  └───────────────────────────────────────────────────────────────────┘   │
│            │                                                             │
│  ┌─────────┼─────────────────────────────────────────────────────────┐   │
│  │         ▼                                                         │   │
│  │  ┌─────────────────────────────────────────────────────────────┐  │   │
│  │  │                    消息层 (Messaging)                      │  │   │
│  │  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │  │   │
│  │  │  │ Message Queue│  │   Pub/Sub   │  │ Event Stream│        │  │   │
│  │  │  │  (消息队列)  │  │  (发布订阅) │  │  (事件流)   │        │  │   │
│  │  │  └─────────────┘  └─────────────┘  └─────────────┘        │  │   │
│  │  └─────────────────────────────────────────────────────────────┘  │   │
│  └───────────────────────────────────────────────────────────────────┘   │
│            │                                                             │
│  ┌─────────┼─────────────────────────────────────────────────────────┐   │
│  │         ▼                                                         │   │
│  │  ┌─────────────────────────────────────────────────────────────┐  │   │
│  │  │                    传输层 (Transport)                      │  │   │
│  │  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │  │   │
│  │  │  │   HTTP/2    │  │  WebSocket  │  │    gRPC     │        │  │   │
│  │  │  │             │  │             │  │             │        │  │   │
│  │  │  └─────────────┘  └─────────────┘  └─────────────┘        │  │   │
│  │  └─────────────────────────────────────────────────────────────┘  │   │
│  └───────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 3. 状态共享架构 (黑板模式)

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         共享黑板 (Blackboard)                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                        任务状态区 (Task State)                      │   │
│  │  ┌─────────────────────────────────────────────────────────────┐   │   │
│  │  │  Task ID    │ Status      │ Progress │ Owner    │ Deadline │   │   │
│  │  ├─────────────────────────────────────────────────────────────┤   │   │
│  │  │ task_001    │ RUNNING     │ 75%      │ Exec A1  │ 14:30    │   │   │
│  │  │ task_002    │ PENDING     │ 0%       │ -        │ 15:00    │   │   │
│  │  │ task_003    │ COMPLETED   │ 100%     │ Exec B2  │ 13:45    │   │   │
│  │  │ task_004    │ FAILED      │ 30%      │ Exec C1  │ 14:00    │   │   │
│  │  └─────────────────────────────────────────────────────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                      中间结果区 (Intermediate Results)              │   │
│  │  ┌─────────────────────────────────────────────────────────────┐   │   │
│  │  │  Result ID  │ Data        │ Producer  │ Timestamp │ Valid   │   │   │
│  │  ├─────────────────────────────────────────────────────────────┤   │   │
│  │  │ res_001     │ {...}       │ Exec A1   │ 14:20:15  │ ✓       │   │   │
│  │  │ res_002     │ {...}       │ Exec B1   │ 14:21:30  │ ✓       │   │   │
│  │  │ res_003     │ {...}       │ Exec A2   │ 14:22:45  │ ✗       │   │   │
│  │  └─────────────────────────────────────────────────────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                      知识共享区 (Knowledge Base)                    │   │
│  │  ┌─────────────────────────────────────────────────────────────┐   │   │
│  │  │  Fact ID    │ Content     │ Source    │ Confidence│ Verified│   │   │
│  │  ├─────────────────────────────────────────────────────────────┤   │   │
│  │  │ fact_001    │ "..."       │ Validator │ 0.95      │ ✓       │   │   │
│  │  │ fact_002    │ "..."       │ Validator │ 0.87      │ ✓       │   │   │
│  │  │ fact_003    │ "..."       │ Critic    │ 0.72      │ ✗       │   │   │
│  │  └─────────────────────────────────────────────────────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                      访问控制矩阵 (Access Control)                  │   │
│  │  ┌─────────────┬─────────────┬─────────────┬─────────────┐         │   │
│  │  │    Agent    │ Task State  │  Results    │  Knowledge  │         │   │
│  │  ├─────────────┼─────────────┼─────────────┼─────────────┤         │   │
│  │  │Orchestrator │  R/W        │  R/W        │  R/W        │         │   │
│  │  │Coordinator  │  R/W        │  R/W        │  R          │         │   │
│  │  │Executor     │  R/W (Own)  │  W          │  R          │         │   │
│  │  │Validator    │  R          │  R/W        │  W          │         │   │
│  │  │Critic       │  R          │  R          │  R/W        │         │   │
│  │  └─────────────┴─────────────┴─────────────┴─────────────┘         │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  一致性机制: Vector Clock (向量时钟) + 因果排序                              │
│  持久化: 定期快照 + 增量日志                                                 │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 4. 工作流模式对比

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        工作流模式对比图                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  1. 顺序管道模式 (Sequential Pipeline)                                      │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  Input → [Agent A] → [Agent B] → [Agent C] → Output                │   │
│  │              ↓           ↓           ↓                             │   │
│  │           [Feedback Loop - Optional]                                │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│  适用: 文档审核、代码审查、数据处理流水线                                    │
│                                                                             │
│  2. 并行处理模式 (Parallel Processing)                                      │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                         ┌→ [Agent A] →┐                            │   │
│  │  Input → [Dispatcher] → ├→ [Agent B] →├→ [Aggregator] → Output     │   │
│  │                         └→ [Agent C] →┘                            │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│  适用: MapReduce、投票决策、多源数据收集                                     │
│                                                                             │
│  3. 层级传递模式 (Hierarchical)                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                        [Orchestrator]                               │   │
│  │                      /               \                              │   │
│  │            [Coordinator A]         [Coordinator B]                  │   │
│  │            /          \             /          \                    │   │
│  │      [Exec A1]    [Exec A2]    [Exec B1]    [Exec B2]               │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│  适用: 复杂项目分解、企业级工作流                                            │
│                                                                             │
│  4. 监督者协调模式 (Supervisor)                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                        [Supervisor]                                 │   │
│  │                       /    |    \                                   │   │
│  │                     ↓      ↓      ↓                                 │   │
│  │                [Worker A] [Worker B] [Worker C]                     │   │
│  │                     ↑      ↑      ↑                                 │   │
│  │                     └──────┴──────┘                                 │   │
│  │                          |                                          │   │
│  │                    Status Updates                                   │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│  适用: 实时监控、动态调度、异常处理                                          │
│                                                                             │
│  5. 批评者-审查者模式 (Critic-Reviewer)                                     │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  [Generator] → [Critic] → [Revision Loop] → [Validator] → Output   │   │
│  │                    ↑                           |                    │   │
│  │                    └───────────────────────────┘                    │   │
│  │                              Feedback                               │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│  适用: 内容生成、代码生成、创意工作                                          │
│                                                                             │
│  6. 民主协商模式 (Democratic)                                               │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │   [Proposal A] ──┐                                                  │   │
│  │   [Proposal B] ──┼→ [Voting] → [Consensus] → Output                 │   │
│  │   [Proposal C] ──┘                                                  │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│  适用: 方案选择、资源分配、冲突解决                                          │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 5. 治理机制架构

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         治理机制架构 (Governance)                           │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                         监控层 (Monitoring)                        │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                │   │
│  │  │  系统监控   │  │  应用监控   │  │  业务监控   │                │   │
│  │  │             │  │             │  │             │                │   │
│  │  │ • CPU       │  │ • QPS       │  │ • 任务成功率│                │   │
│  │  │ • Memory    │  │ • Latency   │  │ • Agent利用率│               │   │
│  │  │ • Network   │  │ • Error Rate│  │ • 共识时间  │                │   │
│  │  │ • Disk      │  │ • Throughput│  │ • 冲突次数  │                │   │
│  │  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘                │   │
│  │         └────────────────┴────────────────┘                       │   │
│  │                          │                                        │   │
│  │                          ▼                                        │   │
│  │  ┌─────────────────────────────────────────────────────────────┐  │   │
│  │  │                    告警中心 (Alerting)                     │  │   │
│  │  │  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐       │  │   │
│  │  │  │  P0     │  │  P1     │  │  P2     │  │  P3     │       │  │   │
│  │  │  │Critical │  │  High   │  │ Medium  │  │  Low    │       │  │   │
│  │  │  └─────────┘  └─────────┘  └─────────┘  └─────────┘       │  │   │
│  │  └─────────────────────────────────────────────────────────────┘  │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                         审计层 (Auditing)                          │   │
│  │  ┌─────────────────────────────────────────────────────────────┐   │   │
│  │  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │   │   │
│  │  │  │  操作日志   │  │  消息追踪   │  │  决策记录   │        │   │   │
│  │  │  │             │  │             │  │             │        │   │   │
│  │  │  │ • Agent操作 │  │ • A2A消息   │  │ • 协商过程  │        │   │   │
│  │  │  │ • 工具调用  │  │ • 状态变更  │  │ • 投票记录  │        │   │   │
│  │  │  │ • 结果输出  │  │ • 错误信息  │  │ • 共识达成  │        │   │   │
│  │  │  └─────────────┘  └─────────────┘  └─────────────┘        │   │   │
│  │  └─────────────────────────────────────────────────────────────┘   │   │
│  │                                                                     │   │
│  │  存储: 结构化日志 → 时序数据库 → 长期归档                            │   │
│  │  分析: 实时分析 → 异常检测 → 趋势预测                                │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                        容错层 (Fault Tolerance)                    │   │
│  │  ┌─────────────────────────────────────────────────────────────┐   │   │
│  │  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │   │   │
│  │  │  │  故障检测   │  │  恢复策略   │  │  降级执行   │        │   │   │
│  │  │  │             │  │             │  │             │        │   │   │
│  │  │  │ • 心跳检测  │  │ • 自动重启  │  │ • 简化流程  │        │   │   │
│  │  │  │ • 超时检测  │  │ • 任务重分配│  │ • 本地执行  │        │   │   │
│  │  │  │ • 健康检查  │  │ • 状态恢复  │  │ • 缓存返回  │        │   │   │
│  │  │  └─────────────┘  └─────────────┘  └─────────────┘        │   │   │
│  │  └─────────────────────────────────────────────────────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                        安全层 (Security)                           │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                │   │
│  │  │  输入验证   │  │  输出审核   │  │  权限控制   │                │   │
│  │  │             │  │             │  │             │                │   │
│  │  │ • 消毒处理  │  │ • 内容过滤  │  │ • 最小权限  │                │   │
│  │  │ • 注入检测  │  │ • 敏感信息  │  │ • RBAC      │                │   │
│  │  │ • 格式验证  │  │ • 合规检查  │  │ • 审计追踪  │                │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘                │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 6. SOUL_v4人格集成架构

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    SOUL_v4 人格集成架构                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                    8维度人格模型 (8-Dimension Model)               │   │
│  │                                                                     │   │
│  │   ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                │   │
│  │   │ Personality │  │  Physical   │  │ Motivations │                │   │
│  │   │   人格特质   │  │   外在形象   │  │   动机驱动   │                │   │
│  │   │   (Type A)  │  │   (Type A)  │  │   (Type A)  │                │   │
│  │   └─────────────┘  └─────────────┘  └─────────────┘                │   │
│  │                                                                     │   │
│  │   ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                │   │
│  │   │  Backstory  │  │   Emotions  │  │Relationships│                │   │
│  │   │   背景故事   │  │   情绪系统   │  │   关系网络   │                │   │
│  │   │   (Type B)  │  │   (Type B)  │  │   (Type B)  │                │   │
│  │   └─────────────┘  └─────────────┘  └─────────────┘                │   │
│  │                                                                     │   │
│  │   ┌─────────────┐  ┌─────────────┐                                │   │
│  │   │   Growth    │  │   Conflict  │                                │   │
│  │   │   成长演化   │  │   冲突处理   │                                │   │
│  │   │   (Type B)  │  │   (Type B)  │                                │   │
│  │   └─────────────┘  └─────────────┘                                │   │
│  │                                                                     │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                    角色人格映射 (Role Mapping)                     │   │
│  │                                                                     │   │
│  │   ┌─────────────┬────┬────┬────┬────┬────┬────┬────┬────┐        │   │
│  │   │    Role     │ P  │ Ph │ M  │ B  │ E  │ R  │ G  │ C  │        │   │
│  │   ├─────────────┼────┼────┼────┼────┼────┼────┼────┼────┤        │   │
│  │   │Orchestrator │ 90 │ 85 │ 95 │ 80 │ 75 │ 85 │ 80 │ 85 │        │   │
│  │   │Coordinator  │ 85 │ 80 │ 85 │ 75 │ 80 │ 90 │ 75 │ 75 │        │   │
│  │   │Executor     │ 80 │ 75 │ 85 │ 70 │ 70 │ 75 │ 75 │ 70 │        │   │
│  │   │Validator    │ 75 │ 70 │ 75 │ 70 │ 70 │ 70 │ 70 │ 80 │        │   │
│  │   │Critic       │ 70 │ 65 │ 70 │ 75 │ 65 │ 65 │ 75 │ 90 │        │   │
│  │   └─────────────┴────┴────┴────┴────┴────┴────┴────┴────┘        │   │
│  │                                                                     │   │
│  │   P=Personality, Ph=Physical, M=Motivations, B=Backstory         │   │
│  │   E=Emotions, R=Relationships, G=Growth, C=Conflict              │   │
│  │                                                                     │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                    情绪状态系统 (Emotion System)                   │   │
│  │                                                                     │   │
│  │   ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐     │   │
│  │   │ 兴奋    │ │ 坚定    │ │ 专注    │ │ 担忧    │ │ 反思    │     │   │
│  │   │ Excited │ │Confident│ │ Focused │ │Concerned│ │Reflective│    │   │
│  │   └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘     │   │
│  │                                                                     │   │
│  │   ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐     │   │
│  │   │ 满意    │ │ 好奇    │ │ 耐心    │ │ 紧迫    │ │ 冷静    │     │   │
│  │   │ Content │ │ Curious │ │ Patient │ │  Urgent │ │  Calm   │     │   │
│  │   └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘     │   │
│  │                                                                     │   │
│  │   ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐     │   │
│  │   │ 困惑    │ │ 沮丧    │ │ 感激    │ │ 警惕    │ │ 幽默    │     │   │
│  │   │Confused │ │Frustrated│ │Grateful │ │  Alert  │ │ Playful │     │   │
│  │   └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘     │   │
│  │                                                                     │   │
│  │   ┌─────────┐                                                       │   │
│  │   │ 严肃    │                                                       │   │
│  │   │ Serious │                                                       │   │
│  │   └─────────┘                                                       │   │
│  │                                                                     │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                    一致性检查 (Consistency Check)                  │   │
│  │                                                                     │   │
│  │   ┌─────────────────────────────────────────────────────────────┐   │   │
│  │   │  检查项                    │  权重  │  检查方法            │   │   │
│  │   ├─────────────────────────────────────────────────────────────┤   │   │
│  │   │  Personality一致性         │  20%   │  人格特质稳定性      │   │   │
│  │   │  Physical适配性            │  10%   │  形象-场景匹配度     │   │   │
│  │   │  Motivations清晰度         │  15%   │  动机-行为一致性     │   │   │
│  │   │  Backstory连贯性           │  10%   │  背景叙事一致性      │   │   │
│  │   │  Emotions合理性            │  15%   │  情绪-情境匹配度     │   │   │
│  │   │  Relationships健康度       │  10%   │  关系互动质量        │   │   │
│  │   │  Growth进展度              │  10%   │  演化进度合理性      │   │   │
│  │   │  Conflict处理度            │  10%   │  冲突解决有效性      │   │   │
│  │   └─────────────────────────────────────────────────────────────┘   │   │
│  │                                                                     │   │
│  │   漂移检测: Drift_Score = Σ(维度权重 × 维度漂移度)                   │   │
│  │   等级: 正常(0-25) 轻微(25-40) 中度(40-60) 严重(60-100)              │   │
│  │                                                                     │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 7. 数据流图

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          数据流图 (Data Flow)                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   用户请求                                                                  │
│      │                                                                      │
│      ▼                                                                      │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │                         API Gateway                                │  │
│   │  • 认证授权  • 限流熔断  • 请求路由  • 协议转换                      │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│      │                                                                      │
│      ▼                                                                      │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │                      Orchestrator Agent                            │  │
│   │  1. 解析请求  2. 分解目标  3. 制定策略  4. 分配任务                  │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│      │                                                                      │
│      ├──────────────────┬──────────────────┬──────────────────┐            │
│      ▼                  ▼                  ▼                  ▼            │
│   ┌─────────┐      ┌─────────┐      ┌─────────┐      ┌─────────┐          │
│   │Coord A  │      │Coord B  │      │Coord C  │      │Coord D  │          │
│   └────┬────┘      └────┬────┘      └────┬────┘      └────┬────┘          │
│        │                │                │                │               │
│   ┌────┴────┐      ┌────┴────┐      ┌────┴────┐      ┌────┴────┐          │
│   │         │      │         │      │         │      │         │          │
│   ▼         ▼      ▼         ▼      ▼         ▼      ▼         ▼          │
│ ┌─────┐  ┌─────┐ ┌─────┐  ┌─────┐ ┌─────┐  ┌─────┐ ┌─────┐  ┌─────┐       │
│ │Exec │  │Exec │ │Exec │  │Exec │ │Exec │  │Exec │ │Exec │  │Exec │       │
│ │ A1  │  │ A2  │ │ B1  │  │ B2  │ │ C1  │  │ C2  │ │ D1  │  │ D2  │       │
│ └──┬──┘  └──┬──┘ └──┬──┘  └──┬──┘ └──┬──┘  └──┬──┘ └──┬──┘  └──┬──┘       │
│    │        │       │        │       │        │       │        │          │
│    └────────┴───────┴────────┴───────┴────────┴───────┴────────┘          │
│                              │                                             │
│                              ▼                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │                         Blackboard (黑板)                          │  │
│   │  • 任务状态同步  • 中间结果共享  • 知识积累  • 状态一致性            │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                              │                                             │
│                              ▼                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │                      Validator Agents                              │  │
│   │  • 质量验证  • 逻辑检查  • 安全审计  • 完整性确认                    │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                              │                                             │
│                              ▼                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │                      Result Aggregator                             │  │
│   │  • 结果收集  • 冲突解决  • 共识达成  • 最终输出                      │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                              │                                             │
│                              ▼                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │                         响应用户                                   │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│   辅助流:                                                                   │
│   ┌─────────────┐    ┌─────────────┐    ┌─────────────┐                   │
│   │   Monitor   │◄──►│    Audit    │◄──►│   Metrics   │                   │
│   │   实时监控   │    │   审计日志   │    │   指标收集   │                   │
│   └─────────────┘    └─────────────┘    └─────────────┘                   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 8. 部署架构

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         部署架构 (Deployment)                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                      Kubernetes Cluster                            │   │
│  │                                                                     │   │
│  │  ┌─────────────────────────────────────────────────────────────┐   │   │
│  │  │                     Ingress Controller                       │   │   │
│  │  │              (Nginx / Traefik / Istio Gateway)               │   │   │
│  │  └─────────────────────────────────────────────────────────────┘   │   │
│  │                              │                                      │   │
│  │  ┌───────────────────────────┼───────────────────────────────┐    │   │
│  │  │                           ▼                               │    │   │
│  │  │  ┌─────────────────────────────────────────────────────┐  │    │   │
│  │  │  │                 Service Mesh (Istio)               │  │    │   │
│  │  │  │  • 流量管理  • 安全通信  • 可观测性  • 策略执行    │  │    │   │
│  │  │  └─────────────────────────────────────────────────────┘  │    │   │
│  │  │                                                           │    │   │
│  │  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐       │    │   │
│  │  │  │ Orchestrator│  │ Coordinator │  │  Executor   │       │    │   │
│  │  │  │   Pod x1    │  │   Pod x3    │  │   Pod x6    │       │    │   │
│  │  │  │             │  │             │  │             │       │    │   │
│  │  │  │ • 协调者    │  │ • 调度者    │  │ • 执行者    │       │    │   │
│  │  │  │ • 策略制定  │  │ • 负载均衡  │  │ • 工具调用  │       │    │   │
│  │  │  └─────────────┘  └─────────────┘  └─────────────┘       │    │   │
│  │  │                                                           │    │   │
│  │  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐       │    │   │
│  │  │  │  Validator  │  │   Critic    │  │   Monitor   │       │    │   │
│  │  │  │   Pod x2    │  │   Pod x2    │  │   Sidecar   │       │    │   │
│  │  │  │             │  │             │  │             │       │    │   │
│  │  │  │ • 验证者    │  │ • 批评者    │  │ • 监控代理  │       │    │   │
│  │  │  │ • 质量检查  │  │ • 风险分析  │  │ • 指标收集  │       │    │   │
│  │  │  └─────────────┘  └─────────────┘  └─────────────┘       │    │   │
│  │  └───────────────────────────────────────────────────────────┘    │   │
│  │                                                                     │   │
│  │  ┌─────────────────────────────────────────────────────────────┐   │   │
│  │  │                    数据层 (Data Layer)                     │   │   │
│  │  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │   │   │
│  │  │  │   Redis     │  │  PostgreSQL │  │ Elasticsearch│        │   │   │
│  │  │  │  (消息队列)  │  │  (状态存储)  │  │  (日志搜索)  │        │   │   │
│  │  │  └─────────────┘  └─────────────┘  └─────────────┘        │   │   │
│  │  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │   │   │
│  │  │  │   Kafka     │  │  Prometheus │  │    MinIO    │        │   │   │
│  │  │  │  (事件流)   │  │  (指标存储)  │  │  (对象存储)  │        │   │   │
│  │  │  └─────────────┘  └─────────────┘  └─────────────┘        │   │   │
│  │  └─────────────────────────────────────────────────────────────┘   │   │
│  │                                                                     │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  扩展策略:                                                                  │
│  • Horizontal Pod Autoscaler (HPA): 基于CPU/内存/自定义指标自动扩缩容      │
│  • Vertical Pod Autoscaler (VPA): 自动调整Pod资源请求                      │
│  • Cluster Autoscaler: 基于节点资源自动扩缩集群                            │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

*架构图版本: 1.0*  
*更新日期: 2026-02-27*  
*配套文档: AGENTS_v2.md*
